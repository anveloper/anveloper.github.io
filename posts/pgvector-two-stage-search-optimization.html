<!DOCTYPE html><!--v9KHsH1kC8eSRcwtdGJil--><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/fonts/PretendardVariable-subset.woff2" as="font" crossorigin="anonymous" type="font/woff2"/><link rel="stylesheet" href="/_next/static/chunks/f530ac11b30b3af0.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/bb3d3f0f00f8c26b.js"/><script src="/_next/static/chunks/965dba060c630c21.js" async=""></script><script src="/_next/static/chunks/e3f6e9c7d91d28be.js" async=""></script><script src="/_next/static/chunks/2a5a9040eca19519.js" async=""></script><script src="/_next/static/chunks/turbopack-eb47450658f9c499.js" async=""></script><script src="/_next/static/chunks/cfc3767bca0bc286.js" async=""></script><script src="/_next/static/chunks/8e14ec824c461f29.js" async=""></script><script src="/_next/static/chunks/1c8dd1e98f29bd04.js" async=""></script><script src="/_next/static/chunks/de15131553ab167d.js" async=""></script><script src="/_next/static/chunks/adc93b9d12c01e00.js" async=""></script><script src="/_next/static/chunks/8d5d30bb3315a01b.js" async=""></script><script src="/_next/static/chunks/77bb2061874ac018.js" async=""></script><script src="/_next/static/chunks/38e38e36e6ce0d91.js" async=""></script><script src="/_next/static/chunks/659198ab3dae4258.js" async=""></script><script src="/_next/static/chunks/99d37ae7b03a4a6d.js" async=""></script><script src="/_next/static/chunks/3d082df2bbbd0a90.js" async=""></script><script src="/_next/static/chunks/4cb06eecdd277427.js" async=""></script><script src="/_next/static/chunks/0ab5dbfaee40510f.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-GMZ6W7F2WX" as="script"/><link rel="preload" href="/fonts/PretendardVariable-subset.woff2" as="font" type="font/woff2" crossorigin="anonymous"/><link rel="preconnect" href="https://img.shields.io"/><link rel="shortcut icon" href="/favicon-light.svg"/><link rel="icon" href="/favicon-light.svg"/><link rel="apple-touch-icon" href="/favicon-light.svg"/><title>pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기 | 안성진</title><meta name="description" content="LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다."/><meta name="keywords" content="pgvector,PostgreSQL,Vector Search,RAG,OpenAI"/><meta name="robots" content="index, follow"/><meta name="google-site-verification" content="kpYkq06WB0cQDLByVOdZD_5HXLkbxzFAvQKQ-Rp9sKY"/><meta property="og:title" content="pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기"/><meta property="og:description" content="LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다."/><meta property="og:url" content="https://anveloper.dev/posts/pgvector-two-stage-search-optimization"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기"/><meta name="twitter:description" content="LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다."/><script>
  (function() {
    try {
      var theme = localStorage.getItem('theme');
      var valid = ['light', 'dark', 'korean', 'terminal'];
      var root = document.documentElement;
      root.classList.remove('light', 'dark', 'korean', 'terminal');
      if (valid.indexOf(theme) !== -1) {
        root.classList.add(theme);
      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        root.classList.add('dark');
      }
    } catch (e) {}
  })();
</script><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen flex flex-col bg-background text-foreground antialiased"><div hidden=""><!--$--><!--/$--></div><main class="flex-1 flex flex-col"><!--$?--><template id="B:0"></template><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50" aria-hidden="true"><path d="M12 2v4"></path><path d="m16.2 7.8 2.9-2.9"></path><path d="M18 12h4"></path><path d="m16.2 16.2 2.9 2.9"></path><path d="M12 18v4"></path><path d="m4.9 19.1 2.9-2.9"></path><path d="M2 12h4"></path><path d="m4.9 4.9 2.9 2.9"></path></svg><!--/$--></main><footer class="border-t border-border"><div class="max-w-4xl mx-auto px-6 sm:px-8 md:px-12 lg:px-16 py-6 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm text-muted-foreground"><span>© 2025 anveloper.dev</span><nav class="flex items-center gap-3"><span class="flex items-center gap-3"><a class="hover:text-foreground transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/anveloper">GitHub</a></span><span class="flex items-center gap-3"><span aria-hidden="true">·</span><a class="hover:text-foreground transition-colors" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/anveloper">LinkedIn</a></span><span class="flex items-center gap-3"><span aria-hidden="true">·</span><a class="hover:text-foreground transition-colors" href="/contact">Contact</a></span></nav></div></footer><script>requestAnimationFrame(function(){$RT=performance.now()});</script><script src="/_next/static/chunks/bb3d3f0f00f8c26b.js" id="_R_" async=""></script><div hidden id="S:0"><div class="pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen"><div class="w-full max-w-4xl mx-auto"><nav class="hidden xl:block fixed left-[calc(50%+29.5rem)] top-28 w-52 max-h-[calc(100vh-8rem)] overflow-y-auto" aria-label="목차"><p class="text-sm font-semibold text-foreground mb-3">목차</p><ul class="space-y-1.5 border-l border-border"><li><a href="#pgvector-postgresql의-벡터-검색-확장" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">pgvector: PostgreSQL의 벡터 검색 확장</a></li><li><a href="#인덱스-hnsw-vs-ivfflat" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">인덱스: HNSW vs IVFFlat</a></li><li><a href="#배경" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">배경</a></li><li><a href="#2단계-검색이란" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">2단계 검색이란</a></li><li><a href="#스키마-설계-halfvec--파티셔닝" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">스키마 설계: halfvec + 파티셔닝</a></li><li><a href="#핵심-테이블" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">핵심 테이블</a></li><li><a href="#halfvecfloat16" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">halfvec(float16)</a></li><li><a href="#hnsw-인덱스" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">HNSW 인덱스</a></li><li><a href="#검색-쿼리" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">검색 쿼리</a></li><li><a href="#인프라-비용-비교-핵심-효과" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">인프라 비용 비교: 핵심 효과</a></li><li><a href="#월-인프라-비용-비교" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">월 인프라 비용 비교</a></li><li><a href="#검색-성능" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">검색 성능</a></li><li><a href="#인덱싱-전략별-비교" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">인덱싱 전략별 비교</a></li><li><a href="#1000만-건-비교" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">1,000만 건 비교</a></li><li><a href="#임베딩-비용" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">임베딩 비용</a></li><li><a href="#단계별-확장-로드맵" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">단계별 확장 로드맵</a></li><li><a href="#정리" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">정리</a></li></ul></nav><a class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6" href="/posts"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg><span>포스트 목록으로 돌아가기</span></a><header class="border-b border-border pb-6 mb-8"><h1 class="text-2xl sm:text-3xl font-bold text-foreground mb-4">pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기</h1><div class="flex flex-wrap items-center gap-4 mb-4"><span class="text-sm text-muted-foreground">2026-02-10</span></div><div class="flex flex-wrap gap-2"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">pgvector</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">PostgreSQL</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">Vector Search</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">RAG</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">OpenAI</div></div></header><article class="prose prose-neutral dark:prose-invert max-w-none"><h1 id="pgvector-2단계-검색-전략으로-벡터-검색-비용-16로-줄이기" class="text-4xl font-bold mt-10 mb-5 text-foreground">pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기</h1>
<h2 id="pgvector-postgresql의-벡터-검색-확장" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">pgvector: PostgreSQL의 벡터 검색 확장</h2>
<p class="my-5 leading-7 text-foreground/90">pgvector는 PostgreSQL에 벡터 유사도 검색 기능을 추가하는 오픈소스 확장이다. 전용 벡터 DB(Pinecone, Milvus, Qdrant)와 달리, <strong class="font-semibold text-foreground">기존 PostgreSQL 인프라에서 관계형 데이터와 벡터를 통합 관리</strong>할 수 있다는 것이 최대 장점이다. 별도 인프라 없이 JOIN, 트랜잭션, 인덱스 등 PostgreSQL의 모든 기능을 벡터 데이터와 함께 사용할 수 있다.</p>
<h3 id="인덱스-hnsw-vs-ivfflat" class="text-2xl font-semibold mt-8 mb-3 text-foreground">인덱스: HNSW vs IVFFlat</h3>
<p class="my-5 leading-7 text-foreground/90">pgvector는 두 가지 근사 최근접 이웃(ANN) 인덱스를 지원한다.</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">항목</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">HNSW</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">IVFFlat</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">검색 속도</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">빠름 (speed-recall 트레이드오프 우수)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">보통</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">빌드 속도</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">느림</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">빠름</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">메모리 사용</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">높음</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">낮음</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">데이터 없이 빌드</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">가능</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">불가 (학습 단계 필요)</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">동적 데이터</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">강함 (삽입/삭제 영향 적음)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">약함 (재빌드 권장)</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">v0.7.0에서 도입된 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>halfvec</span></span></code></span>(float16) 타입은 벡터 저장 공간을 <strong class="font-semibold text-foreground">50% 절감</strong>하면서도 검색 품질(recall) 손실이 거의 없다. 또한 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>halfvec</span></span></code></span>은 HNSW에서 <strong class="font-semibold text-foreground">4000차원</strong>까지 지원하여, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>vector</span></span></code></span>(float32)의 2000차원 제한을 넘어 대형 임베딩 모델(OpenAI 3072차원 등)과의 호환성이 높다.</p>
<p class="my-5 leading-7 text-foreground/90">v0.8.0에서는 <strong class="font-semibold text-foreground">반복 스캐닝</strong>(iterative scan)이 추가되어, 필터 조건과 벡터 검색을 결합할 때 결과가 부족한 &quot;오버필터링&quot; 문제를 해결했다. <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>hnsw.iterative_scan</span></span></code></span>과 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>ivfflat.iterative_scan</span></span></code></span> 파라미터로 활성화할 수 있다.</p>
<p class="my-5 leading-7 text-foreground/90">이 글에서는 pgvector의 HNSW + halfvec에 PostgreSQL 파티셔닝과 LLM 사전 분류를 결합한 <strong class="font-semibold text-foreground">2단계 검색 전략</strong>으로, 2,000만 건 규모에서 인프라 비용을 1/6로 줄인 과정을 정리한다.</p>
<h2 id="배경" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">배경</h2>
<p class="my-5 leading-7 text-foreground/90">디자인 템플릿 AI 생성 시스템에서 RAG(검색 증강 생성)를 구현해야 했다. 사용자가 &quot;미니멀한 흑백 명함&quot;이라고 요청하면, DB에서 유사한 기존 템플릿을 검색하여 AI가 참고하도록 하는 구조다.</p>
<p class="my-5 leading-7 text-foreground/90">문제는 규모다. 기본 템플릿 ~1,000만 건, 사용자 커스텀 포함 최대 ~2,000만 건의 XML 디자인 데이터를 벡터 검색해야 한다. 전용 벡터 DB(Milvus, Pinecone)를 도입하면 인프라 복잡도가 올라가고, 메타데이터와의 조인이 번거롭다.</p>
<p class="my-5 leading-7 text-foreground/90">PostgreSQL의 pgvector 확장을 선택했다. 관계형 데이터와 벡터를 단일 DB에서 통합 관리할 수 있기 때문이다. 하지만 2,000만 건 규모의 벡터 인덱스를 메모리에 올리려면 서버 사양이 상당히 높아야 했다. 이 문제를 해결한 것이 <strong class="font-semibold text-foreground">2단계 검색 전략</strong>이다.</p>
<h2 id="2단계-검색이란" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">2단계 검색이란</h2>
<p class="my-5 leading-7 text-foreground/90">사용자 입력에서 <strong class="font-semibold text-foreground">생산 타입(POD_TYPE)을 먼저 분류</strong>한 뒤, 해당 파티션 내에서만 벡터 검색을 수행하는 전략이다.</p>
<div class="my-6 flex justify-center overflow-x-auto bg-card rounded-lg border border-border p-4 [&amp;_svg]:max-w-full"></div>
<p class="my-5 leading-7 text-foreground/90">Stage 1의 POD_TYPE 분류는 LLM(Orchestrator)이 수행한다. &quot;명함 만들어줘&quot; → <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>namecard</span></span></code></span>, &quot;티셔츠 디자인&quot; → <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>tshirt</span></span></code></span>처럼 비교적 단순한 분류 작업이므로, 별도 비용 없이 기존 오케스트레이션 과정에서 함께 처리한다.</p>
<h2 id="스키마-설계-halfvec--파티셔닝" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">스키마 설계: halfvec + 파티셔닝</h2>
<h3 id="핵심-테이블" class="text-2xl font-semibold mt-8 mb-3 text-foreground">핵심 테이블</h3>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="sql" data-theme="github-dark github-light"><code data-language="sql" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 생산 타입 마스터 (~50종)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> &quot;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">T_POD_TYPE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">&quot; (</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;TYPE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> PRIMARY KEY</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,  </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- namecard, tshirt, leaflet 등</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;NAME&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 템플릿 (메타데이터 + 벡터) — POD_TYPE 파티셔닝</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> &quot;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">T_TEMPLATE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">&quot; (</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;SEQNO&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> SERIAL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;POD_TYPE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> REFERENCES</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;T_POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">),</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;NAME&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;XML_CONTENT&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;EMBEDDING&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> halfvec(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">3072</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">),</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    PRIMARY KEY</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;SEQNO&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">PARTITION</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> BY</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> LIST (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 파티션 생성</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> t_template_namecard</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> PARTITION</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> OF </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;T_TEMPLATE&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    FOR</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> VALUES</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> IN</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&#x27;namecard&#x27;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> t_template_tshirt</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> PARTITION</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> OF </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;T_TEMPLATE&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    FOR</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> VALUES</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> IN</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&#x27;tshirt&#x27;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- ... ~50종</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">두 가지 핵심 결정이 있다.</p>
<h3 id="halfvecfloat16" class="text-2xl font-semibold mt-8 mb-3 text-foreground">halfvec(float16)</h3>
<p class="my-5 leading-7 text-foreground/90">OpenAI text-embedding-3-large의 3072차원 벡터를 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>vector(3072)</span></span></code></span> 대신 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>halfvec(3072)</span></span></code></span>로 저장한다.</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">타입</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">1건 크기</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">100만 건</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2,000만 건</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">vector (float32)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">12.0 KB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">11.4 GB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">229 GB</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">halfvec (float16)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">6.0 KB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5.7 GB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">114 GB</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">저장 50% 절감이면서, 검색 정확도(recall) 손실은 거의 없다. 또한 halfvec은 HNSW 인덱스에서 4000차원까지 지원하므로, 3072차원에서도 HNSW를 사용할 수 있다 (vector 타입은 2000차원 제한).</p>
<h3 id="hnsw-인덱스" class="text-2xl font-semibold mt-8 mb-3 text-foreground">HNSW 인덱스</h3>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="sql" data-theme="github-dark github-light"><code data-language="sql" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> INDEX</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> &quot;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">IDX_TEMPLATE_EMBEDDING_HNSW</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    ON</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;T_TEMPLATE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> USING</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> hnsw (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;EMBEDDING&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> halfvec_cosine_ops)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    WITH</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (m </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 16</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, ef_construction </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 64</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 검색 시 정확도 조절</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">SET</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> hnsw</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">ef_search</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 100</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">;</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">파티션 테이블에 인덱스를 생성하면 각 파티션별로 자동 생성된다. 인덱스 빌드 메모리도 파티션 단위로 분산된다.</p>
<h2 id="검색-쿼리" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">검색 쿼리</h2>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="sql" data-theme="github-dark github-light"><code data-language="sql" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">SELECT</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;SEQNO&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;NAME&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">       1</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> -</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;EMBEDDING&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &lt;=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">::halfvec) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">AS</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> similarity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">FROM</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;T_TEMPLATE&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">WHERE</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;POD_TYPE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">2</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">  -- Stage 1에서 LLM이 분류한 생산 타입</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">ORDER BY</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;EMBEDDING&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &lt;=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">::halfvec</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">LIMIT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">3</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">;</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>&lt;=&gt;</span></span></code></span> 연산자가 코사인 거리다. <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>WHERE &quot;POD_TYPE&quot; = $2</span></span></code></span> 조건으로 PostgreSQL이 자동으로 파티션 프루닝을 수행하여, 해당 파티션의 HNSW 인덱스만 사용한다.</p>
<p class="my-5 leading-7 text-foreground/90">Python(asyncpg) 구현:</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="python" data-theme="github-dark github-light"><code data-language="python" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">vector </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> np.array(query_embedding, </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209">dtype</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">np.float16)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">rows </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> pool.fetch(</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;SELECT &quot;SEQNO&quot;, &quot;NAME&quot;, &quot;POD_TYPE&quot;, &#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;1 - (&quot;EMBEDDING&quot; &lt;=&gt; $1::halfvec) AS similarity &#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;FROM &quot;T_TEMPLATE&quot; WHERE &quot;POD_TYPE&quot; = $2 &#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;ORDER BY &quot;EMBEDDING&quot; &lt;=&gt; $1::halfvec LIMIT $3&#x27;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    vector, pod_type, top_k</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span></code></pre></figure>
<h2 id="인프라-비용-비교-핵심-효과" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">인프라 비용 비교: 핵심 효과</h2>
<p class="my-5 leading-7 text-foreground/90">2단계 검색의 가장 큰 가치는 <strong class="font-semibold text-foreground">검색 속도 향상이 아닌 인프라 사이징 최적화</strong>다.</p>
<p class="my-5 leading-7 text-foreground/90">HNSW 인덱스는 메모리에 올라가야 성능이 나온다. 2단계 검색이 없으면 전체 데이터 기준으로 서버를 사이징해야 하지만, 2단계 검색을 적용하면 <strong class="font-semibold text-foreground">최대 파티션 크기 기준</strong>으로 사이징하면 된다.</p>
<p class="my-5 leading-7 text-foreground/90">10개 POD_TYPE 균등 분포 기준:</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">전체 데이터</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">파티션당 검색 대상</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~10만 건</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~100만 건</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~200만 건</td></tr></tbody></table></div>
<h3 id="월-인프라-비용-비교" class="text-2xl font-semibold mt-8 mb-3 text-foreground">월 인프라 비용 비교</h3>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">규모</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 미적용</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 적용</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">절감률</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~57만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~25만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">56%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~384만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~57만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">85%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">~564만 원</strong></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">~102만 원</strong></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">82%</strong></td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">2,000만 건 기준으로 월 <strong class="font-semibold text-foreground">462만 원</strong> 절감. 연간으로 환산하면 약 5,500만 원이다.</p>
<h3 id="검색-성능" class="text-2xl font-semibold mt-8 mb-3 text-foreground">검색 성능</h3>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">규모</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 미적용</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 적용</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~20ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2~5ms</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">20~80ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~15ms</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">40~150ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~20ms</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">검색 레이턴시도 개선되지만, 핵심은 인프라 비용 절감이다.</p>
<h2 id="인덱싱-전략별-비교" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">인덱싱 전략별 비교</h2>
<p class="my-5 leading-7 text-foreground/90">4가지 전략을 검토했다.</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">전략</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">차원</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">인덱스</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">특징</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">A. halfvec + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072 (f16)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">저장 50% 절감, 정확도 유지</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">B. 파티셔닝 + A + 2단계 검색</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072 (f16)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HNSW (파티션별)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">인프라 비용 대폭 절감</strong></td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">C. 1536차원 + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1536 (f32)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">정확도 ~5% 하락</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">D. 전용 Vector DB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">자체</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">인프라 복잡, 현재 규모에서 불필요</td></tr></tbody></table></div>
<h3 id="1000만-건-비교" class="text-2xl font-semibold mt-8 mb-3 text-foreground">1,000만 건 비교</h3>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">전략</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">API (1회)</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">월 인프라</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">검색 레이턴시</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Recall@10</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">A. halfvec + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$225</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~384만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">20~80ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~98%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">B. 파티셔닝 + 2단계</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$225</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">~57만 원</strong></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~15ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~99%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">C. 1536 + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$225</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~192만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">15~50ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~94%</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">전략 B가 비용, 성능, 정확도 모든 면에서 우위다. 전략 C는 halfvec 3072와 저장 용량이 같으면서 정확도만 5% 하락하므로 비권장이다.</p>
<h2 id="임베딩-비용" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">임베딩 비용</h2>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">항목</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">값</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">모델</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">OpenAI text-embedding-3-large</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">차원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">단가 (Batch API)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$0.065 / 1M tokens</td></tr></tbody></table></div>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">규모</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">총 토큰</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Standard</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Batch (50% 할인)</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3억</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$39</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">$19.5</strong></td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">30억</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$390</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">$195</strong></td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">임베딩은 1회성 인덱싱 비용이다. Batch API를 사용하면 50% 할인을 받을 수 있다.</p>
<h2 id="단계별-확장-로드맵" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">단계별 확장 로드맵</h2>
<p class="my-5 leading-7 text-foreground/90">처음부터 파티셔닝으로 시작하여, Phase 전환 시 스키마 마이그레이션을 제거했다.</p>
<div class="my-6 flex justify-center overflow-x-auto bg-card rounded-lg border border-border p-4 [&amp;_svg]:max-w-full"></div>
<p class="my-5 leading-7 text-foreground/90">Phase 1부터 파티셔닝을 적용하면 100만 건에서 오버헤드는 무시할 수준이면서, Phase 2/3 전환 시 데이터만 추가하면 된다.</p>
<h2 id="정리" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">정리</h2>
<p class="my-5 leading-7 text-foreground/90">2단계 검색 전략의 핵심은 세 가지다.</p>
<ol class="my-5 ml-6 list-decimal space-y-2">
<li class="text-foreground/90 leading-7">
<p class="my-5 leading-7 text-foreground/90"><strong class="font-semibold text-foreground">LLM 분류와 DB 파티셔닝의 결합</strong>: Orchestrator가 이미 수행하는 작업(사용자 의도 분석)에 POD_TYPE 분류를 추가한 것이므로, 별도 비용 없이 검색 범위를 1/10로 줄일 수 있다.</p>
</li>
<li class="text-foreground/90 leading-7">
<p class="my-5 leading-7 text-foreground/90"><strong class="font-semibold text-foreground">halfvec으로 정확도 유지 + 비용 절감</strong>: float16 저장으로 용량 50% 절감하면서, 3072차원을 유지하여 임베딩 정확도 손실이 없다.</p>
</li>
<li class="text-foreground/90 leading-7">
<p class="my-5 leading-7 text-foreground/90"><strong class="font-semibold text-foreground">처음부터 파티셔닝으로 시작</strong>: 100만 건이든 2,000만 건이든 동일한 스키마로 운영하여, 확장 시 마이그레이션 비용을 제거했다.</p>
</li>
</ol>
<p class="my-5 leading-7 text-foreground/90">전용 벡터 DB를 도입하지 않고 PostgreSQL 하나로 관계형 데이터와 벡터 검색을 통합한 덕분에, 인프라 운영 복잡도도 최소화할 수 있었다.</p></article><section class="mt-12 pt-8 border-t border-border"></section></div></div><!--$--><!--/$--></div><script>$RB=[];$RV=function(a){$RT=performance.now();for(var b=0;b<a.length;b+=2){var c=a[b],e=a[b+1];null!==e.parentNode&&e.parentNode.removeChild(e);var f=c.parentNode;if(f){var g=c.previousSibling,h=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d||"/&"===d)if(0===h)break;else h--;else"$"!==d&&"$?"!==d&&"$~"!==d&&"$!"!==d&&"&"!==d||h++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;e.firstChild;)f.insertBefore(e.firstChild,c);g.data="$";g._reactRetry&&requestAnimationFrame(g._reactRetry)}}a.length=0};
$RC=function(a,b){if(b=document.getElementById(b))(a=document.getElementById(a))?(a.previousSibling.data="$~",$RB.push(a,b),2===$RB.length&&("number"!==typeof $RT?requestAnimationFrame($RV.bind(null,$RB)):(a=performance.now(),setTimeout($RV.bind(null,$RB),2300>a&&2E3<a?2300-a:$RT+300-a)))):b.parentNode.removeChild(b)};$RC("B:0","S:0")</script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[443316,[\"/_next/static/chunks/cfc3767bca0bc286.js\",\"/_next/static/chunks/8e14ec824c461f29.js\"],\"default\"]\n3:I[163720,[\"/_next/static/chunks/cfc3767bca0bc286.js\",\"/_next/static/chunks/8e14ec824c461f29.js\"],\"NavBar\"]\n4:I[925270,[\"/_next/static/chunks/1c8dd1e98f29bd04.js\",\"/_next/static/chunks/de15131553ab167d.js\"],\"default\"]\n5:I[585455,[\"/_next/static/chunks/1c8dd1e98f29bd04.js\",\"/_next/static/chunks/de15131553ab167d.js\"],\"default\"]\n6:I[951506,[\"/_next/static/chunks/cfc3767bca0bc286.js\",\"/_next/static/chunks/8e14ec824c461f29.js\",\"/_next/static/chunks/adc93b9d12c01e00.js\",\"/_next/static/chunks/8d5d30bb3315a01b.js\",\"/_next/static/chunks/77bb2061874ac018.js\",\"/_next/static/chunks/38e38e36e6ce0d91.js\",\"/_next/static/chunks/659198ab3dae4258.js\",\"/_next/static/chunks/99d37ae7b03a4a6d.js\",\"/_next/static/chunks/3d082df2bbbd0a90.js\",\"/_next/static/chunks/4cb06eecdd277427.js\",\"/_next/static/chunks/0ab5dbfaee40510f.js\"],\"\"]\ne:I[807871,[\"/_next/static/chunks/1c8dd1e98f29bd04.js\",\"/_next/static/chunks/de15131553ab167d.js\"],\"default\"]\n:HL[\"/_next/static/chunks/f530ac11b30b3af0.css\",\"style\"]\n:HL[\"/fonts/PretendardVariable-subset.woff2\",\"font\",{\"crossOrigin\":\"anonymous\",\"type\":\"font/woff2\"}]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"v9KHsH1kC8eSRcwtdGJil\",\"c\":[\"\",\"posts\",\"pgvector-two-stage-search-optimization\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"pgvector-two-stage-search-optimization\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/f530ac11b30b3af0.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/cfc3767bca0bc286.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/8e14ec824c461f29.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\n  (function() {\\n    try {\\n      var theme = localStorage.getItem('theme');\\n      var valid = ['light', 'dark', 'korean', 'terminal'];\\n      var root = document.documentElement;\\n      root.classList.remove('light', 'dark', 'korean', 'terminal');\\n      if (valid.indexOf(theme) !== -1) {\\n        root.classList.add(theme);\\n      } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\\n        root.classList.add('dark');\\n      }\\n    } catch (e) {}\\n  })();\\n\"}}],[\"$\",\"link\",null,{\"rel\":\"preload\",\"href\":\"/fonts/PretendardVariable-subset.woff2\",\"as\":\"font\",\"type\":\"font/woff2\",\"crossOrigin\":\"anonymous\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://img.shields.io\"}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon-light.svg\"}]]}],[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col bg-background text-foreground antialiased\",\"children\":[[\"$\",\"$L3\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 flex flex-col\",\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full max-w-4xl mx-auto\",\"children\":[\"$\",\"div\",null,{\"className\":\"py-24 flex flex-col items-center text-center\",\"children\":[[\"$\",\"p\",null,{\"className\":\"text-6xl font-bold text-muted-foreground/30 mb-6\",\"children\":\"404\"}],[\"$\",\"h1\",null,{\"className\":\"text-2xl font-bold text-foreground mb-2\",\"children\":\"페이지를 찾을 수 없습니다\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground mb-8\",\"children\":\"요청하신 페이지가 존재하지 않거나 삭제되었습니다.\"}],[\"$\",\"$L6\",null,{\"href\":\"/\",\"className\":\"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"홈으로 돌아가기\"}]]}]]}]}]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"border-t border-border\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-4xl mx-auto px-6 sm:px-8 md:px-12 lg:px-16 py-6 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm text-muted-foreground\",\"children\":[[\"$\",\"span\",null,{\"children\":\"© 2025 anveloper.dev\"}],[\"$\",\"nav\",null,{\"className\":\"flex items-center gap-3\",\"children\":[[\"$\",\"span\",\"GitHub\",{\"className\":\"flex items-center gap-3\",\"children\":[false,[\"$\",\"$L6\",null,{\"href\":\"https://github.com/anveloper\",\"className\":\"hover:text-foreground transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"GitHub\"}]]}],[\"$\",\"span\",\"LinkedIn\",{\"className\":\"flex items-center gap-3\",\"children\":[[\"$\",\"span\",null,{\"aria-hidden\":true,\"children\":\"·\"}],[\"$\",\"$L6\",null,{\"href\":\"https://www.linkedin.com/in/anveloper\",\"className\":\"hover:text-foreground transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"LinkedIn\"}]]}],[\"$\",\"span\",\"Contact\",{\"className\":\"flex items-center gap-3\",\"children\":[[\"$\",\"span\",null,{\"aria-hidden\":true,\"children\":\"·\"}],\"$L7\"]}]]}]]}]}],\"$L8\"]}]]}]]}],{\"children\":[\"$L9\",{\"children\":[\"$La\",{\"children\":[\"$Lb\",{},null,false,false]},null,false,false]},null,false,false]},[\"$Lc\",[],[]],false,false],\"$Ld\",false]],\"m\":\"$undefined\",\"G\":[\"$e\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:I[453013,[\"/_next/static/chunks/cfc3767bca0bc286.js\",\"/_next/static/chunks/8e14ec824c461f29.js\"],\"default\"]\n11:I[95276,[\"/_next/static/chunks/1c8dd1e98f29bd04.js\",\"/_next/static/chunks/de15131553ab167d.js\"],\"OutletBoundary\"]\n12:\"$Sreact.suspense\"\n14:I[95276,[\"/_next/static/chunks/1c8dd1e98f29bd04.js\",\"/_next/static/chunks/de15131553ab167d.js\"],\"ViewportBoundary\"]\n16:I[95276,[\"/_next/static/chunks/1c8dd1e98f29bd04.js\",\"/_next/static/chunks/de15131553ab167d.js\"],\"MetadataBoundary\"]\n7:[\"$\",\"$L6\",null,{\"href\":\"/contact\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"Contact\"}]\n8:[\"$\",\"$Lf\",null,{}]\n9:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\na:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\nb:[\"$\",\"$1\",\"c\",{\"children\":[\"$L10\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/adc93b9d12c01e00.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/8d5d30bb3315a01b.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/77bb2061874ac018.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-3\",{\"src\":\"/_next/static/chunks/38e38e36e6ce0d91.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-4\",{\"src\":\"/_next/static/chunks/659198ab3dae4258.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-5\",{\"src\":\"/_next/static/chunks/99d37ae7b03a4a6d.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-6\",{\"src\":\"/_next/static/chunks/3d082df2bbbd0a90.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-7\",{\"src\":\"/_next/static/chunks/4cb06eecdd277427.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-8\",{\"src\":\"/_next/static/chunks/0ab5dbfaee40510f.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L11\",null,{\"children\":[\"$\",\"$12\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@13\"}]}]]}]\nc:[\"$\",\"svg\",\"l\",{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"3427ic\",{\"d\":\"M12 2v4\"}],[\"$\",\"path\",\"r700ao\",{\"d\":\"m16.2 7.8 2.9-2.9\"}],[\"$\",\"path\",\"wj9ykh\",{\"d\":\"M18 12h4\"}],[\"$\",\"path\",\"1bxg5t\",{\"d\":\"m16.2 16.2 2.9 2.9\"}],[\"$\",\"path\",\"jadmvz\",{\"d\":\"M12 18v4\"}],[\"$\",\"path\",\"bwix9q\",{\"d\":\"m4.9 19.1 2.9-2.9\"}],[\"$\",\"path\",\"j09sii\",{\"d\":\"M2 12h4\"}],[\"$\",\"path\",\"giyufr\",{\"d\":\"m4.9 4.9 2.9 2.9\"}],\"$undefined\"]}]\nd:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L14\",null,{\"children\":\"$L15\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L16\",null,{\"children\":[\"$\",\"$12\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L17\"}]}]}],null]}]\n"])</script><script>self.__next_f.push([1,"15:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"18:I[166627,[\"/_next/static/chunks/cfc3767bca0bc286.js\",\"/_next/static/chunks/8e14ec824c461f29.js\",\"/_next/static/chunks/adc93b9d12c01e00.js\",\"/_next/static/chunks/8d5d30bb3315a01b.js\",\"/_next/static/chunks/77bb2061874ac018.js\",\"/_next/static/chunks/38e38e36e6ce0d91.js\",\"/_next/static/chunks/659198ab3dae4258.js\",\"/_next/static/chunks/99d37ae7b03a4a6d.js\",\"/_next/static/chunks/3d082df2bbbd0a90.js\",\"/_next/static/chunks/4cb06eecdd277427.js\",\"/_next/static/chunks/0ab5dbfaee40510f.js\"],\"TableOfContents\"]\n1a:I[826107,[\"/_next/static/chunks/cfc3767bca0bc286.js\",\"/_next/static/chunks/8e14ec824c461f29.js\",\"/_next/static/chunks/adc93b9d12c01e00.js\",\"/_next/static/chunks/8d5d30bb3315a01b.js\",\"/_next/static/chunks/77bb2061874ac018.js\",\"/_next/static/chunks/38e38e36e6ce0d91.js\",\"/_next/static/chunks/659198ab3dae4258.js\",\"/_next/static/chunks/99d37ae7b03a4a6d.js\",\"/_next/static/chunks/3d082df2bbbd0a90.js\",\"/_next/static/chunks/4cb06eecdd277427.js\",\"/_next/static/chunks/0ab5dbfaee40510f.js\"],\"GiscusComments\"]\n"])</script><script>self.__next_f.push([1,"10:[\"$\",\"div\",null,{\"className\":\"pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full max-w-4xl mx-auto\",\"children\":[[\"$\",\"$L18\",null,{\"items\":[{\"id\":\"pgvector-postgresql의-벡터-검색-확장\",\"text\":\"pgvector: PostgreSQL의 벡터 검색 확장\",\"level\":2},{\"id\":\"인덱스-hnsw-vs-ivfflat\",\"text\":\"인덱스: HNSW vs IVFFlat\",\"level\":3},{\"id\":\"배경\",\"text\":\"배경\",\"level\":2},{\"id\":\"2단계-검색이란\",\"text\":\"2단계 검색이란\",\"level\":2},{\"id\":\"스키마-설계-halfvec--파티셔닝\",\"text\":\"스키마 설계: halfvec + 파티셔닝\",\"level\":2},{\"id\":\"핵심-테이블\",\"text\":\"핵심 테이블\",\"level\":3},{\"id\":\"halfvecfloat16\",\"text\":\"halfvec(float16)\",\"level\":3},{\"id\":\"hnsw-인덱스\",\"text\":\"HNSW 인덱스\",\"level\":3},{\"id\":\"검색-쿼리\",\"text\":\"검색 쿼리\",\"level\":2},{\"id\":\"인프라-비용-비교-핵심-효과\",\"text\":\"인프라 비용 비교: 핵심 효과\",\"level\":2},{\"id\":\"월-인프라-비용-비교\",\"text\":\"월 인프라 비용 비교\",\"level\":3},{\"id\":\"검색-성능\",\"text\":\"검색 성능\",\"level\":3},{\"id\":\"인덱싱-전략별-비교\",\"text\":\"인덱싱 전략별 비교\",\"level\":2},{\"id\":\"1000만-건-비교\",\"text\":\"1,000만 건 비교\",\"level\":3},{\"id\":\"임베딩-비용\",\"text\":\"임베딩 비용\",\"level\":2},{\"id\":\"단계별-확장-로드맵\",\"text\":\"단계별 확장 로드맵\",\"level\":2},{\"id\":\"정리\",\"text\":\"정리\",\"level\":2}]}],[\"$\",\"$L6\",null,{\"href\":\"/posts\",\"className\":\"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"포스트 목록으로 돌아가기\"}]]}],[\"$\",\"header\",null,{\"className\":\"border-b border-border pb-6 mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl sm:text-3xl font-bold text-foreground mb-4\",\"children\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-4 mb-4\",\"children\":[\"$\",\"span\",null,{\"className\":\"text-sm text-muted-foreground\",\"children\":\"2026-02-10\"}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"div\",\"pgvector\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"pgvector\"}],[\"$\",\"div\",\"PostgreSQL\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"PostgreSQL\"}],[\"$\",\"div\",\"Vector Search\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"Vector Search\"}],[\"$\",\"div\",\"RAG\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"RAG\"}],[\"$\",\"div\",\"OpenAI\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"OpenAI\"}]]}]]}],[\"$\",\"article\",null,{\"className\":\"prose prose-neutral dark:prose-invert max-w-none\",\"children\":\"$L19\"}],[\"$\",\"$L1a\",null,{}]]}]}]\n"])</script><script>self.__next_f.push([1,"13:null\n17:[[\"$\",\"title\",\"0\",{\"children\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기 | 안성진\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다.\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"pgvector,PostgreSQL,Vector Search,RAG,OpenAI\"}],[\"$\",\"meta\",\"3\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"4\",{\"name\":\"google-site-verification\",\"content\":\"kpYkq06WB0cQDLByVOdZD_5HXLkbxzFAvQKQ-Rp9sKY\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"https://anveloper.dev/posts/pgvector-two-stage-search-optimization\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:title\",\"content\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:description\",\"content\":\"LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다.\"}]]\n"])</script><script>self.__next_f.push([1,"19:[[\"$\",\"h1\",null,{\"id\":\"pgvector-2단계-검색-전략으로-벡터-검색-비용-16로-줄이기\",\"children\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\",\"className\":\"text-4xl font-bold mt-10 mb-5 text-foreground\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"pgvector-postgresql의-벡터-검색-확장\",\"children\":\"pgvector: PostgreSQL의 벡터 검색 확장\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"pgvector는 PostgreSQL에 벡터 유사도 검색 기능을 추가하는 오픈소스 확장이다. 전용 벡터 DB(Pinecone, Milvus, Qdrant)와 달리, \",[\"$\",\"strong\",null,{\"children\":\"기존 PostgreSQL 인프라에서 관계형 데이터와 벡터를 통합 관리\",\"className\":\"font-semibold text-foreground\"}],\"할 수 있다는 것이 최대 장점이다. 별도 인프라 없이 JOIN, 트랜잭션, 인덱스 등 PostgreSQL의 모든 기능을 벡터 데이터와 함께 사용할 수 있다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"인덱스-hnsw-vs-ivfflat\",\"children\":\"인덱스: HNSW vs IVFFlat\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"pgvector는 두 가지 근사 최근접 이웃(ANN) 인덱스를 지원한다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"항목\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"IVFFlat\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"검색 속도\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"빠름 (speed-recall 트레이드오프 우수)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"보통\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"빌드 속도\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"느림\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"빠름\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"메모리 사용\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"높음\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"낮음\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"데이터 없이 빌드\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"가능\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"불가 (학습 단계 필요)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"동적 데이터\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"강함 (삽입/삭제 영향 적음)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"약함 (재빌드 권장)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}],\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\",\"\\n\",\"$L3f\",\"\\n\",\"$L40\",\"\\n\",\"$L41\",\"\\n\",\"$L42\",\"\\n\",\"$L43\",\"\\n\",\"$L44\",\"\\n\",\"$L45\",\"\\n\",\"$L46\",\"\\n\",\"$L47\",\"\\n\",\"$L48\",\"\\n\",\"$L49\",\"\\n\",\"$L4a\",\"\\n\",\"$L4b\",\"\\n\",\"$L4c\",\"\\n\",\"$L4d\",\"\\n\",\"$L4e\",\"\\n\",\"$L4f\",\"\\n\",\"$L50\",\"\\n\",\"$L51\",\"\\n\",\"$L52\"]\n"])</script><script>self.__next_f.push([1,"53:I[463508,[\"/_next/static/chunks/cfc3767bca0bc286.js\",\"/_next/static/chunks/8e14ec824c461f29.js\",\"/_next/static/chunks/adc93b9d12c01e00.js\",\"/_next/static/chunks/8d5d30bb3315a01b.js\",\"/_next/static/chunks/77bb2061874ac018.js\",\"/_next/static/chunks/38e38e36e6ce0d91.js\",\"/_next/static/chunks/659198ab3dae4258.js\",\"/_next/static/chunks/99d37ae7b03a4a6d.js\",\"/_next/static/chunks/3d082df2bbbd0a90.js\",\"/_next/static/chunks/4cb06eecdd277427.js\",\"/_next/static/chunks/0ab5dbfaee40510f.js\"],\"Mermaid\"]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"p\",null,{\"children\":[\"v0.7.0에서 도입된 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"halfvec\"}]}]}]}],\"(float16) 타입은 벡터 저장 공간을 \",[\"$\",\"strong\",null,{\"children\":\"50% 절감\",\"className\":\"font-semibold text-foreground\"}],\"하면서도 검색 품질(recall) 손실이 거의 없다. 또한 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"halfvec\"}]}]}]}],\"은 HNSW에서 \",[\"$\",\"strong\",null,{\"children\":\"4000차원\",\"className\":\"font-semibold text-foreground\"}],\"까지 지원하여, \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"vector\"}]}]}]}],\"(float32)의 2000차원 제한을 넘어 대형 임베딩 모델(OpenAI 3072차원 등)과의 호환성이 높다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"1c:[\"$\",\"p\",null,{\"children\":[\"v0.8.0에서는 \",[\"$\",\"strong\",null,{\"children\":\"반복 스캐닝\",\"className\":\"font-semibold text-foreground\"}],\"(iterative scan)이 추가되어, 필터 조건과 벡터 검색을 결합할 때 결과가 부족한 \\\"오버필터링\\\" 문제를 해결했다. \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"hnsw.iterative_scan\"}]}]}]}],\"과 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ivfflat.iterative_scan\"}]}]}]}],\" 파라미터로 활성화할 수 있다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n1d:[\"$\",\"p\",null,{\"children\":[\"이 글에서는 pgvector의 HNSW + halfvec에 PostgreSQL 파티셔닝과 LLM 사전 분류를 결합한 \",[\"$\",\"strong\",null,{\"children\":\"2단계 검색 전략\",\"className\":\"font-semibold text-foreground\"}],\"으로, 2,000만 건 규모에서 인프라 비용을 1/6로 줄인 과정을 정리한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n1e:[\"$\",\"h2\",null,{\"id\":\"배경\",\"children\":\"배경\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n1f:[\"$\",\"p\",null,{\"children\":\"디자인 템플릿 AI 생성 시스템에서 RAG(검색 증강 생성)를 구현해야 했다. 사용자가 \\\"미니멀한 흑백 명함\\\"이라고 요청하면, DB에서 유사한 기존 템플릿을 검색하여 AI가 참고하도록 하는 구조다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n20:[\"$\",\"p\",null,{\"children\":\"문제는 규모다. 기본 템플릿 ~1,000만 건, 사용자 커스텀 포함 최대 ~2,000만 건의 XML 디자인 데이터를 벡터 검색해야 한다. 전용 벡터 DB(Milvus, Pinecone)를 도입하면 인프라 복잡도가 올라가고, 메타데이터와의 조인이 번거롭다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n21:[\"$\",\"p\",null,{\"children\":[\"PostgreSQL의 pgvector 확장을 선택했다. 관계형 데이터와 벡터를 단일 DB에서 통합 관리할 수 있기 때문이다. 하지만 2,000만 건 규모의 벡터 인덱스를 메모리에 올리려면 서버 사양이 상당히 높아야 했다. 이 문제를 해결한 것이 \",[\"$\",\"strong\",null,{\"children\":\"2단계 검색 전략\",\"className\":\"font-semibold text-foreground\"}],\"이다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n22:[\"$\",\"h2\",null,{\"id\":\"2단계-검색이란\",\"children\":\"2단계 검색이란\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n23:[\"$\",\"p\",null,{\"children\":[\"사용자 입력에서 \",[\"$\",\"strong\",null,{\"children\":\"생산 타입(POD_TYPE)을 먼저 분류\",\"className\":\"font-semibold text-foreground\"}],\"한 뒤, 해당 파티션 내에서만 벡터 검색을 수행하는 전략이다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n24:[\"$\",\"$L53\",null,{\"chart\":\"flowchart TD\\n    Input[\u0026quot;사용자: 미니멀한 흑백 명함 만들어줘\u0026quot;] --\u003e S1\\n\\n    subgraph S1[\u0026quot;Stage 1 — Orchestrator (Claude Sonnet)\u0026quot;]\\n        direction LR\\n        Classify[\u0026quot;LLM이 프롬프트에서 생산 타입 분류\u0026quot;]\\n        Classify --\u003e Type[\u0026quot;pod_type: namecard\u0026quot;]\\n        Classify --\u003e Query[\u0026quot;search_query: 미니멀 흑백 비즈니스 카드\u0026quot;]\\n    end\\n\\n    S1 --\u003e S2\\n\\n    subgraph S2[\u0026quot;Stage 2 — Retriever (OpenAI Embedding + pgvector)\u0026quot;]\\n        direction LR\\n        Filter[\u0026quot;WHERE POD_TYPE = 'namecard' 파티션만 검색\u0026quot;]\\n        Filter --\u003e Scan[\u0026quot;전체 2,000만 건 중 ~200만 "])</script><script>self.__next_f.push([1,"건만 스캔\u0026quot;]\\n    end\\n\\n    S2 --\u003e Result[\u0026quot;유사 템플릿 top-k 반환\u0026quot;]\"}]\n25:[\"$\",\"p\",null,{\"children\":[\"Stage 1의 POD_TYPE 분류는 LLM(Orchestrator)이 수행한다. \\\"명함 만들어줘\\\" → \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"namecard\"}]}]}]}],\", \\\"티셔츠 디자인\\\" → \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"tshirt\"}]}]}]}],\"처럼 비교적 단순한 분류 작업이므로, 별도 비용 없이 기존 오케스트레이션 과정에서 함께 처리한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n26:[\"$\",\"h2\",null,{\"id\":\"스키마-설계-halfvec--파티셔닝\",\"children\":\"스키마 설계: halfvec + 파티셔닝\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n27:[\"$\",\"h3\",null,{\"id\":\"핵심-테이블\",\"children\":\"핵심 테이블\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"28:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 생산 타입 마스터 (~50종)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"T_POD_TYPE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"\\\" (\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" PRIMARY KEY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",  \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- namecard, tshirt, leaflet 등\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"NAME\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 템플릿 (메타데이터 + 벡터) — POD_TYPE 파티셔닝\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"T_TEMPLATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"\\\" (\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"SEQNO\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" SERIAL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" REFERENCES\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"T_POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"),\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"NAME\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"XML_CONTENT\\\"\"}],\"$L54\",\"$L55\",\"$L56\"]}],\"\\n\",\"$L57\",\"\\n\",\"$L58\",\"\\n\",\"$L59\",\"\\n\",\"$L5a\",\"\\n\",\"$L5b\",\"\\n\",\"$L5c\",\"\\n\",\"$L5d\",\"\\n\",\"$L5e\",\"\\n\",\"$L5f\",\"\\n\",\"$L60\"]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"29:[\"$\",\"p\",null,{\"children\":\"두 가지 핵심 결정이 있다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n2a:[\"$\",\"h3\",null,{\"id\":\"halfvecfloat16\",\"children\":\"halfvec(float16)\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n2b:[\"$\",\"p\",null,{\"children\":[\"OpenAI text-embedding-3-large의 3072차원 벡터를 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"vector(3072)\"}]}]}]}],\" 대신 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"halfvec(3072)\"}]}]}]}],\"로 저장한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"2c:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"타입\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"1건 크기\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"vector (float32)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"12.0 KB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"11.4 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"229 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"halfvec (float16)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"6.0 KB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5.7 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"114 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"2d:[\"$\",\"p\",null,{\"children\":\"저장 50% 절감이면서, 검색 정확도(recall) 손실은 거의 없다. 또한 halfvec은 HNSW 인덱스에서 4000차원까지 지원하므로, 3072차원에서도 HNSW를 사용할 수 있다 (vector 타입은 2000차원 제한).\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n2e:[\"$\",\"h3\",null,{\"id\":\"hnsw-인덱스\",\"children\":\"HNSW 인덱스\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"2f:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" INDEX\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"IDX_TEMPLATE_EMBEDDING_HNSW\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    ON\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"T_TEMPLATE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" USING\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" hnsw (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" halfvec_cosine_ops)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    WITH\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (m \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" 16\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", ef_construction \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" 64\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 검색 시 정확도 조절\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"SET\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" hnsw\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"ef_search\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" 100\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\";\"}]]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"30:[\"$\",\"p\",null,{\"children\":\"파티션 테이블에 인덱스를 생성하면 각 파티션별로 자동 생성된다. 인덱스 빌드 메모리도 파티션 단위로 분산된다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n31:[\"$\",\"h2\",null,{\"id\":\"검색-쿼리\",\"children\":\"검색 쿼리\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n"])</script><script>self.__next_f.push([1,"32:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"SELECT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"SEQNO\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"NAME\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"       1\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" \u003c=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"::halfvec) \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"AS\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" similarity\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"FROM\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"T_TEMPLATE\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"WHERE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"2\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"  -- Stage 1에서 LLM이 분류한 생산 타입\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"ORDER BY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" \u003c=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"::halfvec\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"LIMIT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"3\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\";\"}]]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"33:[\"$\",\"p\",null,{\"children\":[[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"\u003c=\u003e\"}]}]}]}],\" 연산자가 코사인 거리다. \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"WHERE \\\"POD_TYPE\\\" = $2\"}]}]}]}],\" 조건으로 PostgreSQL이 자동으로 파티션 프루닝을 수행하여, 해당 파티션의 HNSW 인덱스만 사용한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n34:[\"$\",\"p\",null,{\"children\":\"Python(asyncpg) 구현:\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"35:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"python\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"python\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"vector \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" np.array(query_embedding, \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#FFAB70\",\"--shiki-light\":\"#E36209\"},\"children\":\"dtype\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"np.float16)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"rows \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" pool.fetch(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    'SELECT \\\"SEQNO\\\", \\\"NAME\\\", \\\"POD_TYPE\\\", '\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    '1 - (\\\"EMBEDDING\\\" \u003c=\u003e $1::halfvec) AS similarity '\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    'FROM \\\"T_TEMPLATE\\\" WHERE \\\"POD_TYPE\\\" = $2 '\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    'ORDER BY \\\"EMBEDDING\\\" \u003c=\u003e $1::halfvec LIMIT $3'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"    vector, pod_type, top_k\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"36:[\"$\",\"h2\",null,{\"id\":\"인프라-비용-비교-핵심-효과\",\"children\":\"인프라 비용 비교: 핵심 효과\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n37:[\"$\",\"p\",null,{\"children\":[\"2단계 검색의 가장 큰 가치는 \",[\"$\",\"strong\",null,{\"children\":\"검색 속도 향상이 아닌 인프라 사이징 최적화\",\"className\":\"font-semibold text-foreground\"}],\"다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n38:[\"$\",\"p\",null,{\"children\":[\"HNSW 인덱스는 메모리에 올라가야 성능이 나온다. 2단계 검색이 없으면 전체 데이터 기준으로 서버를 사이징해야 하지만, 2단계 검색을 적용하면 \",[\"$\",\"strong\",null,{\"children\":\"최대 파티션 크기 기준\",\"className\":\"font-semibold text-foreground\"}],\"으로 사이징하면 된다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n39:[\"$\",\"p\",null,{\"children\":\"10개 POD_TYPE 균등 분포 기준:\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"3a:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"전체 데이터\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"파티션당 검색 대상\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~10만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~200만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"3b:[\"$\",\"h3\",null,{\"id\":\"월-인프라-비용-비교\",\"children\":\"월 인프라 비용 비교\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"3c:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"규모\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 미적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"절감률\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~57만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~25만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"56%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~384만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~57만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"85%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~564만 원\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~102만 원\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"82%\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"3d:[\"$\",\"p\",null,{\"children\":[\"2,000만 건 기준으로 월 \",[\"$\",\"strong\",null,{\"children\":\"462만 원\",\"className\":\"font-semibold text-foreground\"}],\" 절감. 연간으로 환산하면 약 5,500만 원이다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n3e:[\"$\",\"h3\",null,{\"id\":\"검색-성능\",\"children\":\"검색 성능\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"3f:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"규모\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 미적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~20ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"2~5ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"20~80ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~15ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"40~150ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~20ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"40:[\"$\",\"p\",null,{\"children\":\"검색 레이턴시도 개선되지만, 핵심은 인프라 비용 절감이다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n41:[\"$\",\"h2\",null,{\"id\":\"인덱싱-전략별-비교\",\"children\":\"인덱싱 전략별 비교\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n42:[\"$\",\"p\",null,{\"children\":\"4가지 전략을 검토했다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"43:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"전략\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"차원\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"인덱스\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"특징\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"A. halfvec + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072 (f16)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"저장 50% 절감, 정확도 유지\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"B. 파티셔닝 + A + 2단계 검색\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072 (f16)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HNSW (파티션별)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"인프라 비용 대폭 절감\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"C. 1536차원 + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"1536 (f32)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"정확도 ~5% 하락\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"D. 전용 Vector DB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"자체\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"인프라 복잡, 현재 규모에서 불필요\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"44:[\"$\",\"h3\",null,{\"id\":\"1000만-건-비교\",\"children\":\"1,000만 건 비교\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"45:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"전략\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"API (1회)\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"월 인프라\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"검색 레이턴시\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Recall@10\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"A. halfvec + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$225\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~384만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"20~80ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~98%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"B. 파티셔닝 + 2단계\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$225\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~57만 원\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~15ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~99%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"C. 1536 + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$225\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~192만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"15~50ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~94%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"46:[\"$\",\"p\",null,{\"children\":\"전략 B가 비용, 성능, 정확도 모든 면에서 우위다. 전략 C는 halfvec 3072와 저장 용량이 같으면서 정확도만 5% 하락하므로 비권장이다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n47:[\"$\",\"h2\",null,{\"id\":\"임베딩-비용\",\"children\":\"임베딩 비용\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n"])</script><script>self.__next_f.push([1,"48:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"항목\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"값\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"모델\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"OpenAI text-embedding-3-large\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"차원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"단가 (Batch API)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$0.065 / 1M tokens\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"49:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"규모\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"총 토큰\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Standard\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Batch (50% 할인)\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3억\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$39\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"$$19.5\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"30억\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$390\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"$$195\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4a:[\"$\",\"p\",null,{\"children\":\"임베딩은 1회성 인덱싱 비용이다. Batch API를 사용하면 50% 할인을 받을 수 있다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n4b:[\"$\",\"h2\",null,{\"id\":\"단계별-확장-로드맵\",\"children\":\"단계별 확장 로드맵\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n4c:[\"$\",\"p\",null,{\"children\":\"처음부터 파티셔닝으로 시작하여, Phase 전환 시 스키마 마이그레이션을 제거했다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n4d:[\"$\",\"$L53\",null,{\"chart\":\"flowchart LR\\n    P1[\u0026quot;Phase 1\\\\n100만 건\\\\nAPI ~$22.5\\\\n월 ~25만 원\u0026quot;] --\u003e|데이터 추가| P2[\u0026quot;Phase 2\\\\n1,000만 건\\\\nAPI ~$225\\\\n월 ~57만 원\u0026quot;] --\u003e|데이터 추가| P3[\u0026quot;Phase 3\\\\n2,000만 건\\\\nAPI ~$450\\\\n월 ~102만 원\u0026quot;]\"}]\n4e:[\"$\",\"p\",null,{\"children\":\"Phase 1부터 파티셔닝을 적용하면 100만 건에서 오버헤드는 무시할 수준이면서, Phase 2/3 전환 시 데이터만 추가하면 된다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n4f:[\"$\",\"h2\",null,{\"id\":\"정리\",\"children\":\"정리\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n50:[\"$\",\"p\",null,{\"children\":\"2단계 검색 전략의 핵심은 세 가지다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n51:[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"LLM 분류와 DB 파티셔닝의 결합\",\"className\":\"font-semibold text-foreground\"}],\": Orchestrator가 이미 수행하는 작업(사용자 의도 분석)에 POD_TYPE 분류를 추가한 것이므로, 별도 비용 없이 검색 범위를 1/10로 줄일 수 있다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\"],\"className\":\"text-foreground/90 leading-7\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"halfvec으로 정확도 유지 + 비용 절감\",\"className\":\"font-semibold text-foreground\"}],\": float16 저장으로 용량 50% 절감하면서, 3072차원을 유지하여 임베딩 정확도 손실이 없다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\"],\"className\":\"text-foreground/90 leading-7\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"처음부터 파티셔닝으로 시작\",\"className\":\"font-semibold text-foreground\"}],\": 100만 건이든 2,000만 건이든 동일한 스키마로 운영하여, 확장 시 마이그레이션 비용을 제거했다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\"],\"className\":\"text-foreground/90 leading-7\"}],\"\\n\"],\"className\":\"my-5 ml-6 list-decimal space-y-2\"}]\n52:[\"$\",\"p\",null,{\"children\":\"전용 벡터 DB를 도입하지 않고 PostgreSQL 하나로 관계형 데이터와 벡터 검색을 통합한 덕분에, 인프라 운영 복잡도도 최소화할 수 있었다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"54:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}]\n55:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}]\n56:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]\n57:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" halfvec(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"3072\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"),\"}]]}]\n58:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    PRIMARY KEY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"SEQNO\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}]\n59:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"PARTITION\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" BY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" LIST (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}]\n5a:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]\n5b:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 파티션 생성\"}]}]\n5c:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" t_template_namecard\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" PARTITION\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" OF \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"T_TEMPLATE\\\"\"}]]}]\n5d:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    FOR\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" VALUES\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" IN\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"'namecard'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}]\n5e:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" t_template_tshirt\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" PA"])</script><script>self.__next_f.push([1,"RTITION\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" OF \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"T_TEMPLATE\\\"\"}]]}]\n5f:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    FOR\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" VALUES\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" IN\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"'tshirt'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}]\n60:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- ... ~50종\"}]}]\n"])</script></body></html>