<!DOCTYPE html><!--8U6zZJdP3QEsZKAq7ZyqG--><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/2fa0ba0e22870313.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/a21146379db92032.js"/><script src="/_next/static/chunks/1e278fdde29a4b5a.js" async=""></script><script src="/_next/static/chunks/2e19ce224f1f9d89.js" async=""></script><script src="/_next/static/chunks/a0f43a3390939b7e.js" async=""></script><script src="/_next/static/chunks/turbopack-0062a60ab2ca90b2.js" async=""></script><script src="/_next/static/chunks/032ac46945970232.js" async=""></script><script src="/_next/static/chunks/44aea766f6f80a25.js" async=""></script><script src="/_next/static/chunks/fec9c5c27cbc91d6.js" async=""></script><script src="/_next/static/chunks/221e0744b683f94b.js" async=""></script><script src="/_next/static/chunks/90c5a27ffb71fa4a.js" async=""></script><script src="/_next/static/chunks/bf98b467f5036c3d.js" async=""></script><script src="/_next/static/chunks/948615c9ecde1cb4.js" async=""></script><script src="/_next/static/chunks/c84805df17f0a72a.js" async=""></script><script src="/_next/static/chunks/0e5a02cd06292d2b.js" async=""></script><script src="/_next/static/chunks/85806e5b63a62879.js" async=""></script><script src="/_next/static/chunks/f87ca1afb6e89cb0.js" async=""></script><script src="/_next/static/chunks/311bfda68bef2673.js" async=""></script><script src="/_next/static/chunks/e1a9aaa3e8d4ba89.js" async=""></script><script src="/_next/static/chunks/8fba60bd4135542a.js" async=""></script><link rel="shortcut icon" href="/favicon-light.svg"/><link rel="icon" href="/favicon-light.svg"/><link rel="apple-touch-icon" href="/favicon-light.svg"/><title>pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기 | 안성진</title><meta name="description" content="LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다."/><meta name="keywords" content="pgvector,PostgreSQL,Vector Search,RAG,OpenAI"/><meta name="robots" content="index, follow"/><meta property="og:title" content="pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기"/><meta property="og:description" content="LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다."/><meta property="og:url" content="https://anveloper.dev/posts/pgvector-two-stage-search-optimization"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기"/><meta name="twitter:description" content="LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다."/><script>
  (function() {
    try {
      var theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    } catch (e) {}
  })();
</script><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen flex flex-col bg-background text-foreground antialiased"><div hidden=""><!--$--><!--/$--></div><main class="flex-1 flex flex-col"><!--$?--><template id="B:0"></template><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50" aria-hidden="true"><path d="M12 2v4"></path><path d="m16.2 7.8 2.9-2.9"></path><path d="M18 12h4"></path><path d="m16.2 16.2 2.9 2.9"></path><path d="M12 18v4"></path><path d="m4.9 19.1 2.9-2.9"></path><path d="M2 12h4"></path><path d="m4.9 4.9 2.9 2.9"></path></svg><!--/$--></main><script>requestAnimationFrame(function(){$RT=performance.now()});</script><script src="/_next/static/chunks/a21146379db92032.js" id="_R_" async=""></script><div hidden id="S:0"><div class="pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen bg-[radial-gradient(oklch(0.5_0_0/15%)_1px,transparent_1px)] bg-size-[20px_20px]"><div class="w-full max-w-4xl mx-auto"><nav class="hidden xl:block fixed left-[calc(50%+29.5rem)] top-28 w-52 max-h-[calc(100vh-8rem)] overflow-y-auto" aria-label="목차"><p class="text-sm font-semibold text-foreground mb-3">목차</p><ul class="space-y-1.5 border-l border-border"><li><a href="#배경" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">배경</a></li><li><a href="#2단계-검색이란" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">2단계 검색이란</a></li><li><a href="#스키마-설계-halfvec--파티셔닝" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">스키마 설계: halfvec + 파티셔닝</a></li><li><a href="#핵심-테이블" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">핵심 테이블</a></li><li><a href="#halfvecfloat16" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">halfvec(float16)</a></li><li><a href="#hnsw-인덱스" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">HNSW 인덱스</a></li><li><a href="#검색-쿼리" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">검색 쿼리</a></li><li><a href="#인프라-비용-비교-핵심-효과" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">인프라 비용 비교: 핵심 효과</a></li><li><a href="#월-인프라-비용-비교" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">월 인프라 비용 비교</a></li><li><a href="#검색-성능" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">검색 성능</a></li><li><a href="#인덱싱-전략별-비교" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">인덱싱 전략별 비교</a></li><li><a href="#1000만-건-비교" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">1,000만 건 비교</a></li><li><a href="#임베딩-비용" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">임베딩 비용</a></li><li><a href="#단계별-확장-로드맵" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">단계별 확장 로드맵</a></li><li><a href="#정리" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">정리</a></li></ul></nav><a class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6" href="/posts"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg><span>포스트 목록으로 돌아가기</span></a><div class="rounded-lg border border-border bg-card text-card-foreground shadow-sm mb-8"><div class="p-6 pt-6"><h1 class="text-3xl sm:text-4xl font-bold text-foreground mb-4">pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기</h1><div class="flex flex-wrap items-center gap-4 mb-4"><div class="flex items-center gap-2 text-muted-foreground"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar w-4 h-4" aria-hidden="true"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><span>2026-02-10</span></div></div><div class="flex flex-wrap gap-2"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">pgvector</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">PostgreSQL</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">Vector Search</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">RAG</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">OpenAI</div></div></div></div><article class="prose prose-neutral dark:prose-invert max-w-none"><h1 id="pgvector-2단계-검색-전략으로-벡터-검색-비용-16로-줄이기" class="text-4xl font-bold mt-10 mb-5 text-foreground">pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기</h1>
<h2 id="배경" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">배경</h2>
<p class="my-5 leading-7 text-foreground/90">디자인 템플릿 AI 생성 시스템에서 RAG(검색 증강 생성)를 구현해야 했다. 사용자가 &quot;미니멀한 흑백 명함&quot;이라고 요청하면, DB에서 유사한 기존 템플릿을 검색하여 AI가 참고하도록 하는 구조다.</p>
<p class="my-5 leading-7 text-foreground/90">문제는 규모다. 기본 템플릿 ~1,000만 건, 사용자 커스텀 포함 최대 ~2,000만 건의 XML 디자인 데이터를 벡터 검색해야 한다. 전용 벡터 DB(Milvus, Pinecone)를 도입하면 인프라 복잡도가 올라가고, 메타데이터와의 조인이 번거롭다.</p>
<p class="my-5 leading-7 text-foreground/90">PostgreSQL의 pgvector 확장을 선택했다. 관계형 데이터와 벡터를 단일 DB에서 통합 관리할 수 있기 때문이다. 하지만 2,000만 건 규모의 벡터 인덱스를 메모리에 올리려면 서버 사양이 상당히 높아야 했다. 이 문제를 해결한 것이 <strong class="font-semibold text-foreground">2단계 검색 전략</strong>이다.</p>
<h2 id="2단계-검색이란" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">2단계 검색이란</h2>
<p class="my-5 leading-7 text-foreground/90">사용자 입력에서 <strong class="font-semibold text-foreground">생산 타입(POD_TYPE)을 먼저 분류</strong>한 뒤, 해당 파티션 내에서만 벡터 검색을 수행하는 전략이다.</p>
<div class="my-6 flex justify-center overflow-x-auto bg-card rounded-lg border border-border p-4 [&amp;_svg]:max-w-full"></div>
<p class="my-5 leading-7 text-foreground/90">Stage 1의 POD_TYPE 분류는 LLM(Orchestrator)이 수행한다. &quot;명함 만들어줘&quot; → <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>namecard</span></span></code></span>, &quot;티셔츠 디자인&quot; → <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>tshirt</span></span></code></span>처럼 비교적 단순한 분류 작업이므로, 별도 비용 없이 기존 오케스트레이션 과정에서 함께 처리한다.</p>
<h2 id="스키마-설계-halfvec--파티셔닝" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">스키마 설계: halfvec + 파티셔닝</h2>
<h3 id="핵심-테이블" class="text-2xl font-semibold mt-8 mb-3 text-foreground">핵심 테이블</h3>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="sql" data-theme="github-dark github-light"><code data-language="sql" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 생산 타입 마스터 (~50종)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> &quot;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">T_POD_TYPE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">&quot; (</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;TYPE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> PRIMARY KEY</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,  </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- namecard, tshirt, leaflet 등</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;NAME&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 템플릿 (메타데이터 + 벡터) — POD_TYPE 파티셔닝</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> &quot;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">T_TEMPLATE</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">&quot; (</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;SEQNO&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> SERIAL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;POD_TYPE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> REFERENCES</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;T_POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">),</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;NAME&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;XML_CONTENT&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TEXT</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> NOT NULL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &quot;EMBEDDING&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> halfvec(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">3072</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">),</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    PRIMARY KEY</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;SEQNO&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">PARTITION</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> BY</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> LIST (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 파티션 생성</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> t_template_namecard</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> PARTITION</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> OF </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;T_TEMPLATE&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    FOR</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> VALUES</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> IN</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&#x27;namecard&#x27;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> TABLE</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> t_template_tshirt</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> PARTITION</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> OF </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;T_TEMPLATE&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    FOR</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> VALUES</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> IN</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&#x27;tshirt&#x27;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- ... ~50종</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">두 가지 핵심 결정이 있다.</p>
<h3 id="halfvecfloat16" class="text-2xl font-semibold mt-8 mb-3 text-foreground">halfvec(float16)</h3>
<p class="my-5 leading-7 text-foreground/90">OpenAI text-embedding-3-large의 3072차원 벡터를 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>vector(3072)</span></span></code></span> 대신 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>halfvec(3072)</span></span></code></span>로 저장한다.</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">타입</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">1건 크기</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">100만 건</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2,000만 건</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">vector (float32)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">12.0 KB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">11.4 GB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">229 GB</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">halfvec (float16)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">6.0 KB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5.7 GB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">114 GB</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">저장 50% 절감이면서, 검색 정확도(recall) 손실은 거의 없다. 또한 halfvec은 HNSW 인덱스에서 4000차원까지 지원하므로, 3072차원에서도 HNSW를 사용할 수 있다 (vector 타입은 2000차원 제한).</p>
<h3 id="hnsw-인덱스" class="text-2xl font-semibold mt-8 mb-3 text-foreground">HNSW 인덱스</h3>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="sql" data-theme="github-dark github-light"><code data-language="sql" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">CREATE</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> INDEX</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> &quot;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">IDX_TEMPLATE_EMBEDDING_HNSW</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    ON</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;T_TEMPLATE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> USING</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> hnsw (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;EMBEDDING&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> halfvec_cosine_ops)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    WITH</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (m </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 16</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, ef_construction </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 64</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">-- 검색 시 정확도 조절</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">SET</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> hnsw</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">.</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">ef_search</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> 100</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">;</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">파티션 테이블에 인덱스를 생성하면 각 파티션별로 자동 생성된다. 인덱스 빌드 메모리도 파티션 단위로 분산된다.</p>
<h2 id="검색-쿼리" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">검색 쿼리</h2>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="sql" data-theme="github-dark github-light"><code data-language="sql" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">SELECT</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;SEQNO&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;NAME&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;POD_TYPE&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">       1</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> -</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;EMBEDDING&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &lt;=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">::halfvec) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">AS</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> similarity</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">FROM</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;T_TEMPLATE&quot;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">WHERE</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;POD_TYPE&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">2</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">  -- Stage 1에서 LLM이 분류한 생산 타입</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">ORDER BY</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;EMBEDDING&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> &lt;=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">::halfvec</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">LIMIT</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> $</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5">3</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">;</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>&lt;=&gt;</span></span></code></span> 연산자가 코사인 거리다. <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>WHERE &quot;POD_TYPE&quot; = $2</span></span></code></span> 조건으로 PostgreSQL이 자동으로 파티션 프루닝을 수행하여, 해당 파티션의 HNSW 인덱스만 사용한다.</p>
<p class="my-5 leading-7 text-foreground/90">Python(asyncpg) 구현:</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="python" data-theme="github-dark github-light"><code data-language="python" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">vector </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> np.array(query_embedding, </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209">dtype</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">np.float16)</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">rows </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> pool.fetch(</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;SELECT &quot;SEQNO&quot;, &quot;NAME&quot;, &quot;POD_TYPE&quot;, &#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;1 - (&quot;EMBEDDING&quot; &lt;=&gt; $1::halfvec) AS similarity &#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;FROM &quot;T_TEMPLATE&quot; WHERE &quot;POD_TYPE&quot; = $2 &#x27;</span></span>
<span data-line=""><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">    &#x27;ORDER BY &quot;EMBEDDING&quot; &lt;=&gt; $1::halfvec LIMIT $3&#x27;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">,</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    vector, pod_type, top_k</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)</span></span></code></pre></figure>
<h2 id="인프라-비용-비교-핵심-효과" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">인프라 비용 비교: 핵심 효과</h2>
<p class="my-5 leading-7 text-foreground/90">2단계 검색의 가장 큰 가치는 <strong class="font-semibold text-foreground">검색 속도 향상이 아닌 인프라 사이징 최적화</strong>다.</p>
<p class="my-5 leading-7 text-foreground/90">HNSW 인덱스는 메모리에 올라가야 성능이 나온다. 2단계 검색이 없으면 전체 데이터 기준으로 서버를 사이징해야 하지만, 2단계 검색을 적용하면 <strong class="font-semibold text-foreground">최대 파티션 크기 기준</strong>으로 사이징하면 된다.</p>
<p class="my-5 leading-7 text-foreground/90">10개 POD_TYPE 균등 분포 기준:</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">전체 데이터</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">파티션당 검색 대상</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~10만 건</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~100만 건</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~200만 건</td></tr></tbody></table></div>
<h3 id="월-인프라-비용-비교" class="text-2xl font-semibold mt-8 mb-3 text-foreground">월 인프라 비용 비교</h3>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">규모</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 미적용</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 적용</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">절감률</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~57만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~25만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">56%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~384만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~57만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">85%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">~564만 원</strong></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">~102만 원</strong></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">82%</strong></td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">2,000만 건 기준으로 월 <strong class="font-semibold text-foreground">462만 원</strong> 절감. 연간으로 환산하면 약 5,500만 원이다.</p>
<h3 id="검색-성능" class="text-2xl font-semibold mt-8 mb-3 text-foreground">검색 성능</h3>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">규모</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 미적용</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">2단계 검색 적용</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~20ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2~5ms</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">20~80ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~15ms</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">2,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">40~150ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~20ms</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">검색 레이턴시도 개선되지만, 핵심은 인프라 비용 절감이다.</p>
<h2 id="인덱싱-전략별-비교" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">인덱싱 전략별 비교</h2>
<p class="my-5 leading-7 text-foreground/90">4가지 전략을 검토했다.</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">전략</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">차원</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">인덱스</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">특징</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">A. halfvec + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072 (f16)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">저장 50% 절감, 정확도 유지</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">B. 파티셔닝 + A + 2단계 검색</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072 (f16)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HNSW (파티션별)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">인프라 비용 대폭 절감</strong></td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">C. 1536차원 + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1536 (f32)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">정확도 ~5% 하락</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">D. 전용 Vector DB</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">자체</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">인프라 복잡, 현재 규모에서 불필요</td></tr></tbody></table></div>
<h3 id="1000만-건-비교" class="text-2xl font-semibold mt-8 mb-3 text-foreground">1,000만 건 비교</h3>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">전략</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">API (1회)</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">월 인프라</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">검색 레이턴시</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Recall@10</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">A. halfvec + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$225</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~384만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">20~80ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~98%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">B. 파티셔닝 + 2단계</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$225</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">~57만 원</strong></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">5~15ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~99%</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">C. 1536 + HNSW</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$225</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~192만 원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">15~50ms</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">~94%</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">전략 B가 비용, 성능, 정확도 모든 면에서 우위다. 전략 C는 halfvec 3072와 저장 용량이 같으면서 정확도만 5% 하락하므로 비권장이다.</p>
<h2 id="임베딩-비용" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">임베딩 비용</h2>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">항목</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">값</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">모델</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">OpenAI text-embedding-3-large</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">차원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3072</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">단가 (Batch API)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$0.065 / 1M tokens</td></tr></tbody></table></div>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">규모</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">총 토큰</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Standard</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Batch (50% 할인)</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">100만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">3억</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$39</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">$19.5</strong></td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">1,000만 건</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">30억</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">$390</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><strong class="font-semibold text-foreground">$195</strong></td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">임베딩은 1회성 인덱싱 비용이다. Batch API를 사용하면 50% 할인을 받을 수 있다.</p>
<h2 id="단계별-확장-로드맵" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">단계별 확장 로드맵</h2>
<p class="my-5 leading-7 text-foreground/90">처음부터 파티셔닝으로 시작하여, Phase 전환 시 스키마 마이그레이션을 제거했다.</p>
<div class="my-6 flex justify-center overflow-x-auto bg-card rounded-lg border border-border p-4 [&amp;_svg]:max-w-full"></div>
<p class="my-5 leading-7 text-foreground/90">Phase 1부터 파티셔닝을 적용하면 100만 건에서 오버헤드는 무시할 수준이면서, Phase 2/3 전환 시 데이터만 추가하면 된다.</p>
<h2 id="정리" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">정리</h2>
<p class="my-5 leading-7 text-foreground/90">2단계 검색 전략의 핵심은 세 가지다.</p>
<ol class="my-5 ml-6 list-decimal space-y-2">
<li class="text-foreground/90 leading-7">
<p class="my-5 leading-7 text-foreground/90"><strong class="font-semibold text-foreground">LLM 분류와 DB 파티셔닝의 결합</strong>: Orchestrator가 이미 수행하는 작업(사용자 의도 분석)에 POD_TYPE 분류를 추가한 것이므로, 별도 비용 없이 검색 범위를 1/10로 줄일 수 있다.</p>
</li>
<li class="text-foreground/90 leading-7">
<p class="my-5 leading-7 text-foreground/90"><strong class="font-semibold text-foreground">halfvec으로 정확도 유지 + 비용 절감</strong>: float16 저장으로 용량 50% 절감하면서, 3072차원을 유지하여 임베딩 정확도 손실이 없다.</p>
</li>
<li class="text-foreground/90 leading-7">
<p class="my-5 leading-7 text-foreground/90"><strong class="font-semibold text-foreground">처음부터 파티셔닝으로 시작</strong>: 100만 건이든 2,000만 건이든 동일한 스키마로 운영하여, 확장 시 마이그레이션 비용을 제거했다.</p>
</li>
</ol>
<p class="my-5 leading-7 text-foreground/90">전용 벡터 DB를 도입하지 않고 PostgreSQL 하나로 관계형 데이터와 벡터 검색을 통합한 덕분에, 인프라 운영 복잡도도 최소화할 수 있었다.</p></article></div></div><!--$--><!--/$--></div><script>$RB=[];$RV=function(a){$RT=performance.now();for(var b=0;b<a.length;b+=2){var c=a[b],e=a[b+1];null!==e.parentNode&&e.parentNode.removeChild(e);var f=c.parentNode;if(f){var g=c.previousSibling,h=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d||"/&"===d)if(0===h)break;else h--;else"$"!==d&&"$?"!==d&&"$~"!==d&&"$!"!==d&&"&"!==d||h++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;e.firstChild;)f.insertBefore(e.firstChild,c);g.data="$";g._reactRetry&&requestAnimationFrame(g._reactRetry)}}a.length=0};
$RC=function(a,b){if(b=document.getElementById(b))(a=document.getElementById(a))?(a.previousSibling.data="$~",$RB.push(a,b),2===$RB.length&&("number"!==typeof $RT?requestAnimationFrame($RV.bind(null,$RB)):(a=performance.now(),setTimeout($RV.bind(null,$RB),2300>a&&2E3<a?2300-a:$RT+300-a)))):b.parentNode.removeChild(b)};$RC("B:0","S:0")</script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[28739,[\"/_next/static/chunks/032ac46945970232.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\"],\"Providers\"]\n3:I[63720,[\"/_next/static/chunks/032ac46945970232.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\"],\"NavBar\"]\n4:I[25270,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n5:I[85455,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n6:I[53013,[\"/_next/static/chunks/032ac46945970232.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\"],\"default\"]\n8:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"OutletBoundary\"]\n9:\"$Sreact.suspense\"\nd:I[7871,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n:HL[\"/_next/static/chunks/2fa0ba0e22870313.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"8U6zZJdP3QEsZKAq7ZyqG\",\"c\":[\"\",\"posts\",\"pgvector-two-stage-search-optimization\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"pgvector-two-stage-search-optimization\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/2fa0ba0e22870313.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/032ac46945970232.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/44aea766f6f80a25.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\n  (function() {\\n    try {\\n      var theme = localStorage.getItem('theme');\\n      if (theme === 'dark' || (!theme \u0026\u0026 window.matchMedia('(prefers-color-scheme: dark)').matches)) {\\n        document.documentElement.classList.add('dark');\\n      } else {\\n        document.documentElement.classList.remove('dark');\\n      }\\n    } catch (e) {}\\n  })();\\n\"}}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon-light.svg\"}]]}],[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col bg-background text-foreground antialiased\",\"children\":[[\"$\",\"$L2\",null,{\"children\":[[\"$\",\"$L3\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 flex flex-col\",\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],[\"$\",\"$L6\",null,{}]]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/bf98b467f5036c3d.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/948615c9ecde1cb4.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/c84805df17f0a72a.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-3\",{\"src\":\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-4\",{\"src\":\"/_next/static/chunks/85806e5b63a62879.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-5\",{\"src\":\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-6\",{\"src\":\"/_next/static/chunks/311bfda68bef2673.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-7\",{\"src\":\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-8\",{\"src\":\"/_next/static/chunks/8fba60bd4135542a.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L8\",null,{\"children\":[\"$\",\"$9\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@a\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},[\"$Lb\",[],[]],false,false],\"$Lc\",false]],\"m\":\"$undefined\",\"G\":[\"$d\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"ViewportBoundary\"]\n10:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"MetadataBoundary\"]\nb:[\"$\",\"svg\",\"l\",{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"3427ic\",{\"d\":\"M12 2v4\"}],[\"$\",\"path\",\"r700ao\",{\"d\":\"m16.2 7.8 2.9-2.9\"}],[\"$\",\"path\",\"wj9ykh\",{\"d\":\"M18 12h4\"}],[\"$\",\"path\",\"1bxg5t\",{\"d\":\"m16.2 16.2 2.9 2.9\"}],[\"$\",\"path\",\"jadmvz\",{\"d\":\"M12 18v4\"}],[\"$\",\"path\",\"bwix9q\",{\"d\":\"m4.9 19.1 2.9-2.9\"}],[\"$\",\"path\",\"j09sii\",{\"d\":\"M2 12h4\"}],[\"$\",\"path\",\"giyufr\",{\"d\":\"m4.9 4.9 2.9 2.9\"}],\"$undefined\"]}]\nc:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L10\",null,{\"children\":[\"$\",\"$9\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L11\"}]}]}],null]}]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"12:I[66627,[\"/_next/static/chunks/032ac46945970232.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"/_next/static/chunks/bf98b467f5036c3d.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"TableOfContents\"]\n13:I[51506,[\"/_next/static/chunks/032ac46945970232.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"/_next/static/chunks/bf98b467f5036c3d.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen bg-[radial-gradient(oklch(0.5_0_0/15%)_1px,transparent_1px)] bg-size-[20px_20px]\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full max-w-4xl mx-auto\",\"children\":[[\"$\",\"$L12\",null,{\"items\":[{\"id\":\"배경\",\"text\":\"배경\",\"level\":2},{\"id\":\"2단계-검색이란\",\"text\":\"2단계 검색이란\",\"level\":2},{\"id\":\"스키마-설계-halfvec--파티셔닝\",\"text\":\"스키마 설계: halfvec + 파티셔닝\",\"level\":2},{\"id\":\"핵심-테이블\",\"text\":\"핵심 테이블\",\"level\":3},{\"id\":\"halfvecfloat16\",\"text\":\"halfvec(float16)\",\"level\":3},{\"id\":\"hnsw-인덱스\",\"text\":\"HNSW 인덱스\",\"level\":3},{\"id\":\"검색-쿼리\",\"text\":\"검색 쿼리\",\"level\":2},{\"id\":\"인프라-비용-비교-핵심-효과\",\"text\":\"인프라 비용 비교: 핵심 효과\",\"level\":2},{\"id\":\"월-인프라-비용-비교\",\"text\":\"월 인프라 비용 비교\",\"level\":3},{\"id\":\"검색-성능\",\"text\":\"검색 성능\",\"level\":3},{\"id\":\"인덱싱-전략별-비교\",\"text\":\"인덱싱 전략별 비교\",\"level\":2},{\"id\":\"1000만-건-비교\",\"text\":\"1,000만 건 비교\",\"level\":3},{\"id\":\"임베딩-비용\",\"text\":\"임베딩 비용\",\"level\":2},{\"id\":\"단계별-확장-로드맵\",\"text\":\"단계별 확장 로드맵\",\"level\":2},{\"id\":\"정리\",\"text\":\"정리\",\"level\":2}]}],[\"$\",\"$L13\",null,{\"href\":\"/posts\",\"className\":\"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"포스트 목록으로 돌아가기\"}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"rounded-lg border border-border bg-card text-card-foreground shadow-sm mb-8\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-6\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl sm:text-4xl font-bold text-foreground mb-4\",\"children\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-4 mb-4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center gap-2 text-muted-foreground\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"2026-02-10\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"div\",\"pgvector\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"pgvector\"}],[\"$\",\"div\",\"PostgreSQL\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"PostgreSQL\"}],[\"$\",\"div\",\"Vector Search\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"Vector Search\"}],[\"$\",\"div\",\"RAG\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"RAG\"}],[\"$\",\"div\",\"OpenAI\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"OpenAI\"}]]}]]}]}],[\"$\",\"article\",null,{\"className\":\"prose prose-neutral dark:prose-invert max-w-none\",\"children\":\"$L14\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"a:null\n11:[[\"$\",\"title\",\"0\",{\"children\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기 | 안성진\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다.\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"pgvector,PostgreSQL,Vector Search,RAG,OpenAI\"}],[\"$\",\"meta\",\"3\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다.\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:url\",\"content\":\"https://anveloper.dev/posts/pgvector-two-stage-search-optimization\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:title\",\"content\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:description\",\"content\":\"LLM의 사전 분류와 PostgreSQL 파티셔닝을 결합한 2단계 검색 전략으로, 2000만 건 규모의 벡터 검색 인프라 비용을 대폭 절감한 과정을 정리했다.\"}]]\n"])</script><script>self.__next_f.push([1,"15:I[63508,[\"/_next/static/chunks/032ac46945970232.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"/_next/static/chunks/bf98b467f5036c3d.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"Mermaid\"]\n"])</script><script>self.__next_f.push([1,"14:[[\"$\",\"h1\",null,{\"id\":\"pgvector-2단계-검색-전략으로-벡터-검색-비용-16로-줄이기\",\"children\":\"pgvector 2단계 검색 전략으로 벡터 검색 비용 1/6로 줄이기\",\"className\":\"text-4xl font-bold mt-10 mb-5 text-foreground\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"배경\",\"children\":\"배경\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"디자인 템플릿 AI 생성 시스템에서 RAG(검색 증강 생성)를 구현해야 했다. 사용자가 \\\"미니멀한 흑백 명함\\\"이라고 요청하면, DB에서 유사한 기존 템플릿을 검색하여 AI가 참고하도록 하는 구조다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"문제는 규모다. 기본 템플릿 ~1,000만 건, 사용자 커스텀 포함 최대 ~2,000만 건의 XML 디자인 데이터를 벡터 검색해야 한다. 전용 벡터 DB(Milvus, Pinecone)를 도입하면 인프라 복잡도가 올라가고, 메타데이터와의 조인이 번거롭다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"PostgreSQL의 pgvector 확장을 선택했다. 관계형 데이터와 벡터를 단일 DB에서 통합 관리할 수 있기 때문이다. 하지만 2,000만 건 규모의 벡터 인덱스를 메모리에 올리려면 서버 사양이 상당히 높아야 했다. 이 문제를 해결한 것이 \",[\"$\",\"strong\",null,{\"children\":\"2단계 검색 전략\",\"className\":\"font-semibold text-foreground\"}],\"이다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"2단계-검색이란\",\"children\":\"2단계 검색이란\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"사용자 입력에서 \",[\"$\",\"strong\",null,{\"children\":\"생산 타입(POD_TYPE)을 먼저 분류\",\"className\":\"font-semibold text-foreground\"}],\"한 뒤, 해당 파티션 내에서만 벡터 검색을 수행하는 전략이다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"$L15\",null,{\"chart\":\"flowchart TD\\n    Input[\u0026quot;사용자: 미니멀한 흑백 명함 만들어줘\u0026quot;] --\u003e S1\\n\\n    subgraph S1[\u0026quot;Stage 1 — Orchestrator (Claude Sonnet)\u0026quot;]\\n        direction LR\\n        Classify[\u0026quot;LLM이 프롬프트에서 생산 타입 분류\u0026quot;]\\n        Classify --\u003e Type[\u0026quot;pod_type: namecard\u0026quot;]\\n        Classify --\u003e Query[\u0026quot;search_query: 미니멀 흑백 비즈니스 카드\u0026quot;]\\n    end\\n\\n    S1 --\u003e S2\\n\\n    subgraph S2[\u0026quot;Stage 2 — Retriever (OpenAI Embedding + pgvector)\u0026quot;]\\n        direction LR\\n        Filter[\u0026quot;WHERE POD_TYPE = 'namecard' 파티션만 검색\u0026quot;]\\n        Filter --\u003e Scan[\u0026quot;전체 2,000만 건 중 ~200만 건만 스캔\u0026quot;]\\n    end\\n\\n    S2 --\u003e Result[\u0026quot;유사 템플릿 top-k 반환\u0026quot;]\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Stage 1의 POD_TYPE 분류는 LLM(Orchestrator)이 수행한다. \\\"명함 만들어줘\\\" → \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"namecard\"}]}]}]}],\", \\\"티셔츠 디자인\\\" → \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"tshirt\"}]}]}]}],\"처럼 비교적 단순한 분류 작업이므로, 별도 비용 없이 기존 오케스트레이션 과정에서 함께 처리한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"스키마-설계-halfvec--파티셔닝\",\"children\":\"스키마 설계: halfvec + 파티셔닝\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}],\"\\n\",[\"$\",\"h3\",null,{\"id\":\"핵심-테이블\",\"children\":\"핵심 테이블\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 생산 타입 마스터 (~50종)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$L16\",\"$L17\",\"$L18\",\"$L19\",\"$L1a\"]}],\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\"]}]}],\"className\":\"not-prose my-6\"}],\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\",\"\\n\",\"$L3f\",\"\\n\",\"$L40\",\"\\n\",\"$L41\",\"\\n\",\"$L42\",\"\\n\",\"$L43\",\"\\n\",\"$L44\",\"\\n\",\"$L45\",\"\\n\",\"$L46\",\"\\n\",\"$L47\",\"\\n\",\"$L48\",\"\\n\",\"$L49\",\"\\n\",\"$L4a\",\"\\n\",\"$L4b\",\"\\n\",\"$L4c\",\"\\n\",\"$L4d\",\"\\n\",\"$L4e\",\"\\n\",\"$L4f\",\"\\n\",\"$L50\",\"\\n\",\"$L51\",\"\\n\",\"$L52\",\"\\n\",\"$L53\",\"\\n\",\"$L54\",\"\\n\",\"$L55\",\"\\n\",\"$L56\",\"\\n\",\"$L57\",\"\\n\",\"$L58\"]\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}]\n17:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}]\n18:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" \\\"\"}]\n19:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"T_POD_TYPE\"}]\n1a:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"\\\" (\"}]\n1b:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" PRIMARY KEY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",  \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- namecard, tshirt, leaflet 등\"}]]}]\n1c:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"NAME\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}]]}]\n1d:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]}]\n1e:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]\n1f:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 템플릿 (메타데이터 + 벡터) — POD_TYPE 파티셔닝\"}]}]\n20:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"T_TEMPLATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"\\\" (\"}]]}]\n21:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"SEQNO\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" SERIAL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}]\n22:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" REFERENCES\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"T_POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"),\"}]]}]\n23:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"NAME\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":"])</script><script>self.__next_f.push([1,"\"#24292E\"},\"children\":\",\"}]]}]\n24:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"XML_CONTENT\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TEXT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" NOT NULL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}]\n25:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    \\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" halfvec(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"3072\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"),\"}]]}]\n26:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    PRIMARY KEY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"SEQNO\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]]}]\n27:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"PARTITION\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" BY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" LIST (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}]\n28:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]\n29:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 파티션 생성\"}]}]\n2a:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" t_template_namecard\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" PARTITION\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" OF \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"T_TEMPLATE\\\"\"}]]}]\n2b:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    FOR\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" VALUES\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" IN\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"'namecard'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}]\n2c:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" TABLE\"}],[\"$\",\"span\",null,{\"s"])</script><script>self.__next_f.push([1,"tyle\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" t_template_tshirt\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" PARTITION\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" OF \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"T_TEMPLATE\\\"\"}]]}]\n2d:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    FOR\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" VALUES\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" IN\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"'tshirt'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}]\n2e:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- ... ~50종\"}]}]\n2f:[\"$\",\"p\",null,{\"children\":\"두 가지 핵심 결정이 있다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n30:[\"$\",\"h3\",null,{\"id\":\"halfvecfloat16\",\"children\":\"halfvec(float16)\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n31:[\"$\",\"p\",null,{\"children\":[\"OpenAI text-embedding-3-large의 3072차원 벡터를 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"vector(3072)\"}]}]}]}],\" 대신 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"halfvec(3072)\"}]}]}]}],\"로 저장한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"32:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"타입\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"1건 크기\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"vector (float32)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"12.0 KB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"11.4 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"229 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"halfvec (float16)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"6.0 KB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5.7 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"114 GB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"33:[\"$\",\"p\",null,{\"children\":\"저장 50% 절감이면서, 검색 정확도(recall) 손실은 거의 없다. 또한 halfvec은 HNSW 인덱스에서 4000차원까지 지원하므로, 3072차원에서도 HNSW를 사용할 수 있다 (vector 타입은 2000차원 제한).\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n34:[\"$\",\"h3\",null,{\"id\":\"hnsw-인덱스\",\"children\":\"HNSW 인덱스\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"35:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"CREATE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" INDEX\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" \\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"IDX_TEMPLATE_EMBEDDING_HNSW\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    ON\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"T_TEMPLATE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" USING\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" hnsw (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" halfvec_cosine_ops)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    WITH\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (m \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" 16\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", ef_construction \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" 64\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"-- 검색 시 정확도 조절\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"SET\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" hnsw\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"ef_search\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" 100\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\";\"}]]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"36:[\"$\",\"p\",null,{\"children\":\"파티션 테이블에 인덱스를 생성하면 각 파티션별로 자동 생성된다. 인덱스 빌드 메모리도 파티션 단위로 분산된다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n37:[\"$\",\"h2\",null,{\"id\":\"검색-쿼리\",\"children\":\"검색 쿼리\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n"])</script><script>self.__next_f.push([1,"38:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"sql\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"SELECT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"SEQNO\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"NAME\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"       1\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" \u003c=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"::halfvec) \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"AS\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" similarity\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"FROM\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"T_TEMPLATE\\\"\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"WHERE\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"POD_TYPE\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"2\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"  -- Stage 1에서 LLM이 분류한 생산 타입\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"ORDER BY\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"EMBEDDING\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" \u003c=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"::halfvec\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"LIMIT\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" $\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\"3\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\";\"}]]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"39:[\"$\",\"p\",null,{\"children\":[[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"\u003c=\u003e\"}]}]}]}],\" 연산자가 코사인 거리다. \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"WHERE \\\"POD_TYPE\\\" = $2\"}]}]}]}],\" 조건으로 PostgreSQL이 자동으로 파티션 프루닝을 수행하여, 해당 파티션의 HNSW 인덱스만 사용한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n3a:[\"$\",\"p\",null,{\"children\":\"Python(asyncpg) 구현:\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"3b:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"python\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"python\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"vector \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" np.array(query_embedding, \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#FFAB70\",\"--shiki-light\":\"#E36209\"},\"children\":\"dtype\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"np.float16)\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"rows \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" pool.fetch(\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    'SELECT \\\"SEQNO\\\", \\\"NAME\\\", \\\"POD_TYPE\\\", '\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    '1 - (\\\"EMBEDDING\\\" \u003c=\u003e $1::halfvec) AS similarity '\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    'FROM \\\"T_TEMPLATE\\\" WHERE \\\"POD_TYPE\\\" = $2 '\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"    'ORDER BY \\\"EMBEDDING\\\" \u003c=\u003e $1::halfvec LIMIT $3'\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\",\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"    vector, pod_type, top_k\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\")\"}]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"3c:[\"$\",\"h2\",null,{\"id\":\"인프라-비용-비교-핵심-효과\",\"children\":\"인프라 비용 비교: 핵심 효과\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n3d:[\"$\",\"p\",null,{\"children\":[\"2단계 검색의 가장 큰 가치는 \",[\"$\",\"strong\",null,{\"children\":\"검색 속도 향상이 아닌 인프라 사이징 최적화\",\"className\":\"font-semibold text-foreground\"}],\"다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n3e:[\"$\",\"p\",null,{\"children\":[\"HNSW 인덱스는 메모리에 올라가야 성능이 나온다. 2단계 검색이 없으면 전체 데이터 기준으로 서버를 사이징해야 하지만, 2단계 검색을 적용하면 \",[\"$\",\"strong\",null,{\"children\":\"최대 파티션 크기 기준\",\"className\":\"font-semibold text-foreground\"}],\"으로 사이징하면 된다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n3f:[\"$\",\"p\",null,{\"children\":\"10개 POD_TYPE 균등 분포 기준:\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"40:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"전체 데이터\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"파티션당 검색 대상\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~10만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~200만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"41:[\"$\",\"h3\",null,{\"id\":\"월-인프라-비용-비교\",\"children\":\"월 인프라 비용 비교\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"42:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"규모\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 미적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"절감률\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~57만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~25만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"56%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~384만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~57만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"85%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~564만 원\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~102만 원\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"82%\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"43:[\"$\",\"p\",null,{\"children\":[\"2,000만 건 기준으로 월 \",[\"$\",\"strong\",null,{\"children\":\"462만 원\",\"className\":\"font-semibold text-foreground\"}],\" 절감. 연간으로 환산하면 약 5,500만 원이다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n44:[\"$\",\"h3\",null,{\"id\":\"검색-성능\",\"children\":\"검색 성능\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"45:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"규모\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 미적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"2단계 검색 적용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~20ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"2~5ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"20~80ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~15ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"2,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"40~150ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~20ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"46:[\"$\",\"p\",null,{\"children\":\"검색 레이턴시도 개선되지만, 핵심은 인프라 비용 절감이다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n47:[\"$\",\"h2\",null,{\"id\":\"인덱싱-전략별-비교\",\"children\":\"인덱싱 전략별 비교\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n48:[\"$\",\"p\",null,{\"children\":\"4가지 전략을 검토했다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"49:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"전략\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"차원\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"인덱스\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"특징\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"A. halfvec + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072 (f16)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"저장 50% 절감, 정확도 유지\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"B. 파티셔닝 + A + 2단계 검색\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072 (f16)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HNSW (파티션별)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"인프라 비용 대폭 절감\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"C. 1536차원 + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"1536 (f32)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"정확도 ~5% 하락\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"D. 전용 Vector DB\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"자체\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"인프라 복잡, 현재 규모에서 불필요\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4a:[\"$\",\"h3\",null,{\"id\":\"1000만-건-비교\",\"children\":\"1,000만 건 비교\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"4b:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"전략\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"API (1회)\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"월 인프라\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"검색 레이턴시\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Recall@10\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"A. halfvec + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$225\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~384만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"20~80ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~98%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"B. 파티셔닝 + 2단계\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$225\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"~57만 원\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"5~15ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~99%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"C. 1536 + HNSW\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$225\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~192만 원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"15~50ms\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"~94%\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4c:[\"$\",\"p\",null,{\"children\":\"전략 B가 비용, 성능, 정확도 모든 면에서 우위다. 전략 C는 halfvec 3072와 저장 용량이 같으면서 정확도만 5% 하락하므로 비권장이다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n4d:[\"$\",\"h2\",null,{\"id\":\"임베딩-비용\",\"children\":\"임베딩 비용\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n"])</script><script>self.__next_f.push([1,"4e:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"항목\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"값\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"모델\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"OpenAI text-embedding-3-large\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"차원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3072\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"단가 (Batch API)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$0.065 / 1M tokens\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4f:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"규모\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"총 토큰\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Standard\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Batch (50% 할인)\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"100만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"3억\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$39\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"$$19.5\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"1,000만 건\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"30억\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"$$390\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"$$195\",\"className\":\"font-semibold text-foreground\"}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"50:[\"$\",\"p\",null,{\"children\":\"임베딩은 1회성 인덱싱 비용이다. Batch API를 사용하면 50% 할인을 받을 수 있다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n51:[\"$\",\"h2\",null,{\"id\":\"단계별-확장-로드맵\",\"children\":\"단계별 확장 로드맵\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n52:[\"$\",\"p\",null,{\"children\":\"처음부터 파티셔닝으로 시작하여, Phase 전환 시 스키마 마이그레이션을 제거했다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n53:[\"$\",\"$L15\",null,{\"chart\":\"flowchart LR\\n    P1[\u0026quot;Phase 1\\\\n100만 건\\\\nAPI ~$22.5\\\\n월 ~25만 원\u0026quot;] --\u003e|데이터 추가| P2[\u0026quot;Phase 2\\\\n1,000만 건\\\\nAPI ~$225\\\\n월 ~57만 원\u0026quot;] --\u003e|데이터 추가| P3[\u0026quot;Phase 3\\\\n2,000만 건\\\\nAPI ~$450\\\\n월 ~102만 원\u0026quot;]\"}]\n54:[\"$\",\"p\",null,{\"children\":\"Phase 1부터 파티셔닝을 적용하면 100만 건에서 오버헤드는 무시할 수준이면서, Phase 2/3 전환 시 데이터만 추가하면 된다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n55:[\"$\",\"h2\",null,{\"id\":\"정리\",\"children\":\"정리\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n56:[\"$\",\"p\",null,{\"children\":\"2단계 검색 전략의 핵심은 세 가지다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n57:[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"LLM 분류와 DB 파티셔닝의 결합\",\"className\":\"font-semibold text-foreground\"}],\": Orchestrator가 이미 수행하는 작업(사용자 의도 분석)에 POD_TYPE 분류를 추가한 것이므로, 별도 비용 없이 검색 범위를 1/10로 줄일 수 있다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\"],\"className\":\"text-foreground/90 leading-7\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"halfvec으로 정확도 유지 + 비용 절감\",\"className\":\"font-semibold text-foreground\"}],\": float16 저장으로 용량 50% 절감하면서, 3072차원을 유지하여 임베딩 정확도 손실이 없다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\"],\"className\":\"text-foreground/90 leading-7\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"처음부터 파티셔닝으로 시작\",\"className\":\"font-semibold text-foreground\"}],\": 100만 건이든 2,000만 건이든 동일한 스키마로 운영하여, 확장 시 마이그레이션 비용을 제거했다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\"],\"className\":\"text-foreground/90 leading-7\"}],\"\\n\"],\"className\":\"my-5 ml-6 list-decimal space-y-2\"}]\n58:[\"$\",\"p\",null,{\"children\":\"전용 벡터 DB를 도입하지 않고 PostgreSQL 하나로 관계형 데이터와 벡터 검색을 통합한 덕분에, 인프라 운영 복잡도도 최소화할 수 있었다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script></body></html>