<!DOCTYPE html><!--vRd1ViZQsDeRHYuaUNPkZ--><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/9cf24ed64efb86d5.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/3cabba2d51d6776c.js"/><script src="/_next/static/chunks/1e278fdde29a4b5a.js" async=""></script><script src="/_next/static/chunks/a0f43a3390939b7e.js" async=""></script><script src="/_next/static/chunks/b413c27b71299e21.js" async=""></script><script src="/_next/static/chunks/turbopack-58e70f7d42d758ed.js" async=""></script><script src="/_next/static/chunks/94ee590fcdd715f5.js" async=""></script><script src="/_next/static/chunks/cde3ff9ca0393567.js" async=""></script><script src="/_next/static/chunks/fec9c5c27cbc91d6.js" async=""></script><script src="/_next/static/chunks/221e0744b683f94b.js" async=""></script><script src="/_next/static/chunks/90c5a27ffb71fa4a.js" async=""></script><script src="/_next/static/chunks/bf98b467f5036c3d.js" async=""></script><script src="/_next/static/chunks/948615c9ecde1cb4.js" async=""></script><script src="/_next/static/chunks/c84805df17f0a72a.js" async=""></script><script src="/_next/static/chunks/0e5a02cd06292d2b.js" async=""></script><script src="/_next/static/chunks/85806e5b63a62879.js" async=""></script><script src="/_next/static/chunks/f87ca1afb6e89cb0.js" async=""></script><script src="/_next/static/chunks/311bfda68bef2673.js" async=""></script><script src="/_next/static/chunks/e1a9aaa3e8d4ba89.js" async=""></script><script src="/_next/static/chunks/8fba60bd4135542a.js" async=""></script><link rel="shortcut icon" href="/favicon-light.svg"/><link rel="icon" href="/favicon-light.svg"/><link rel="apple-touch-icon" href="/favicon-light.svg"/><title>Caddy로 멀티테넌트 SSL 자동화하기 | 안성진</title><meta name="description" content="On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기"/><meta name="keywords" content="Caddy,SSL,Multi-tenant,Infrastructure,Let&#x27;s Encrypt"/><meta name="robots" content="index, follow"/><meta name="google-site-verification" content="kpYkq06WB0cQDLByVOdZD_5HXLkbxzFAvQKQ-Rp9sKY"/><meta property="og:title" content="Caddy로 멀티테넌트 SSL 자동화하기"/><meta property="og:description" content="On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기"/><meta property="og:url" content="https://anveloper.dev/posts/caddy-multi-tenant-ssl"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Caddy로 멀티테넌트 SSL 자동화하기"/><meta name="twitter:description" content="On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기"/><script>
  (function() {
    try {
      var theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    } catch (e) {}
  })();
</script><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen flex flex-col bg-background text-foreground antialiased"><div hidden=""><!--$--><!--/$--></div><main class="flex-1 flex flex-col"><!--$?--><template id="B:0"></template><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50" aria-hidden="true"><path d="M12 2v4"></path><path d="m16.2 7.8 2.9-2.9"></path><path d="M18 12h4"></path><path d="m16.2 16.2 2.9 2.9"></path><path d="M12 18v4"></path><path d="m4.9 19.1 2.9-2.9"></path><path d="M2 12h4"></path><path d="m4.9 4.9 2.9 2.9"></path></svg><!--/$--></main><footer class="border-t border-border"><div class="max-w-4xl mx-auto px-6 sm:px-8 md:px-12 lg:px-16 py-6 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm text-muted-foreground"><span>© 2025 anveloper.dev</span><nav class="flex items-center gap-3"><span class="flex items-center gap-3"><a class="hover:text-foreground transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/anveloper">GitHub</a></span><span class="flex items-center gap-3"><span aria-hidden="true">·</span><a class="hover:text-foreground transition-colors" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/anveloper">LinkedIn</a></span><span class="flex items-center gap-3"><span aria-hidden="true">·</span><a class="hover:text-foreground transition-colors" href="/contact">Contact</a></span></nav></div></footer><script>requestAnimationFrame(function(){$RT=performance.now()});</script><script src="/_next/static/chunks/3cabba2d51d6776c.js" id="_R_" async=""></script><div hidden id="S:0"><div class="pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen"><div class="w-full max-w-4xl mx-auto"><nav class="hidden xl:block fixed left-[calc(50%+29.5rem)] top-28 w-52 max-h-[calc(100vh-8rem)] overflow-y-auto" aria-label="목차"><p class="text-sm font-semibold text-foreground mb-3">목차</p><ul class="space-y-1.5 border-l border-border"><li><a href="#caddy와-on-demand-tls" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">Caddy와 On-Demand TLS</a></li><li><a href="#배경" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">배경</a></li><li><a href="#왜-caddy인가" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">왜 Caddy인가</a></li><li><a href="#아키텍처" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">아키텍처</a></li><li><a href="#caddyfile-설정" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">Caddyfile 설정</a></li><li><a href="#글로벌-설정-on-demand-tls" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">글로벌 설정: On-Demand TLS</a></li><li><a href="#도메인별-블록" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">도메인별 블록</a></li><li><a href="#보안-헤더" class="block text-[13px] leading-snug py-0.5 transition-colors pl-6 text-muted-foreground hover:text-foreground">보안 헤더</a></li><li><a href="#도메인-검증-api" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">도메인 검증 API</a></li><li><a href="#nextjs-proxyts에서-도메인-라우팅" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">Next.js proxy.ts에서 도메인 라우팅</a></li><li><a href="#와일드카드-인증서-cloudflare-dns-연동" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">와일드카드 인증서: Cloudflare DNS 연동</a></li><li><a href="#배포-pm2--systemd" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">배포: PM2 + systemd</a></li><li><a href="#주의사항" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">주의사항</a></li><li><a href="#마무리" class="block text-[13px] leading-snug py-0.5 transition-colors pl-3 text-muted-foreground hover:text-foreground">마무리</a></li></ul></nav><a class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6" href="/posts"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg><span>포스트 목록으로 돌아가기</span></a><header class="border-b border-border pb-6 mb-8"><h1 class="text-2xl sm:text-3xl font-bold text-foreground mb-4">Caddy로 멀티테넌트 SSL 자동화하기</h1><div class="flex flex-wrap items-center gap-4 mb-4"><span class="text-sm text-muted-foreground">2026-01-14</span></div><div class="flex flex-wrap gap-2"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">Caddy</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">SSL</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">Multi-tenant</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">Infrastructure</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">Let&#x27;s Encrypt</div></div></header><article class="prose prose-neutral dark:prose-invert max-w-none"><h1 id="caddy로-멀티테넌트-ssl-자동화하기" class="text-4xl font-bold mt-10 mb-5 text-foreground">Caddy로 멀티테넌트 SSL 자동화하기</h1>
<h2 id="caddy와-on-demand-tls" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">Caddy와 On-Demand TLS</h2>
<p class="my-5 leading-7 text-foreground/90">Caddy는 Go로 작성된 웹 서버로, <strong class="font-semibold text-foreground">자동 HTTPS</strong>를 최초로 기본 내장한 웹 서버다. Let&#x27;s Encrypt 공개 이전부터 ACME(Automatic Certificate Management Environment) 프로토콜을 사용해왔으며, 내장 ACME 클라이언트의 안정성과 프로덕션 경험은 현존하는 통합 솔루션 중 가장 풍부하다.</p>
<p class="my-5 leading-7 text-foreground/90">Caddy의 핵심 기능 중 하나인 <strong class="font-semibold text-foreground">On-Demand TLS</strong>는 설정 파일에 도메인을 미리 등록하지 않아도, TLS 핸드셰이크 시점에 인증서를 동적으로 발급하는 기술이다. 새로운 도메인으로 첫 HTTPS 요청이 들어오면 핸드셰이크를 잠시 보류하고, 검증 API(<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>ask</span></span></code></span> 엔드포인트)를 호출하여 허용 여부를 확인한 뒤 인증서를 자동 발급한다. 이 기능 덕분에 수만 개의 도메인을 동적으로 관리할 수 있어, 멀티테넌트 SaaS의 커스텀 도메인 지원에 적합하다.</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">기능</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Caddy</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Nginx + certbot</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HTTPS</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">기본 제공 (Let&#x27;s Encrypt/ZeroSSL)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">수동 설정 (certbot 별도 설치)</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">인증서 갱신</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">자동 (만료 30일 전)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">크론잡 필요</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">동적 도메인</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">On-Demand TLS (핸드셰이크 시점 발급)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">설정 수정 + reload 필요</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">ACME 챌린지</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HTTP, TLS-ALPN, DNS 모두 지원</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HTTP만 기본, DNS는 별도 플러그인</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">OCSP Stapling</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">자동</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">수동 설정</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">이 글에서는 Caddy의 On-Demand TLS를 활용하여 멀티테넌트 플랫폼에서 경로/서브도메인/커스텀 도메인 3가지 방식의 SSL을 하나의 Caddyfile로 자동화한 과정을 정리한다.</p>
<h2 id="배경" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">배경</h2>
<p class="my-5 leading-7 text-foreground/90">멀티테넌트 스토어 플랫폼에서 3가지 도메인 방식을 지원해야 했다.</p>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">방식</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">예시</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">SSL 인증서</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">경로</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>store.example.com/acme</span></span></code></span></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">단일 인증서</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">서브도메인</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>acme.mystore.app</span></span></code></span></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">와일드카드 인증서</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">커스텀 도메인</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>shop.acme.com</span></span></code></span></td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">개별 인증서 (동적)</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">핵심 문제는 커스텀 도메인이다. 테넌트가 언제든 자신의 도메인을 연결할 수 있어야 하고, SSL 인증서가 자동으로 발급·갱신되어야 한다. Nginx + certbot 조합으로는 새 도메인을 추가할 때마다 설정 파일을 수정하고 reload해야 하는 번거로움이 있었다.</p>
<h2 id="왜-caddy인가" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">왜 Caddy인가</h2>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">기능</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Caddy</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">Nginx</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">HTTPS</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">기본 제공 (Let&#x27;s Encrypt)</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">수동 설정 (certbot)</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">인증서 갱신</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">자동</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">크론잡 필요</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">동적 도메인 추가</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">API로 즉시 반영</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">설정 수정 + reload</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">설정 복잡도</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">간단</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">복잡</td></tr></tbody></table></div>
<p class="my-5 leading-7 text-foreground/90">Caddy의 <strong class="font-semibold text-foreground">On-Demand TLS</strong>가 결정적이었다. 설정 파일 수정 없이, 새로운 도메인으로 요청이 들어오면 검증 API를 호출하고 통과하면 자동으로 인증서를 발급한다.</p>
<h2 id="아키텍처" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">아키텍처</h2>
<div class="my-6 flex justify-center overflow-x-auto bg-card rounded-lg border border-border p-4 [&amp;_svg]:max-w-full"></div>
<h2 id="caddyfile-설정" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">Caddyfile 설정</h2>
<h3 id="글로벌-설정-on-demand-tls" class="text-2xl font-semibold mt-8 mb-3 text-foreground">글로벌 설정: On-Demand TLS</h3>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="caddyfile" data-theme="github-dark github-light"><code data-language="caddyfile" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span>{</span></span>
<span data-line=""><span>    on_demand_tls {</span></span>
<span data-line=""><span>        ask http://localhost:4033/api/caddy/check-domain</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>}</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>ask</span></span></code></span> 디렉티브가 핵심이다. 새로운 도메인으로 HTTPS 요청이 들어올 때마다, Caddy가 이 URL을 호출하여 인증서를 발급해도 되는지 확인한다.</p>
<h3 id="도메인별-블록" class="text-2xl font-semibold mt-8 mb-3 text-foreground">도메인별 블록</h3>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="caddyfile" data-theme="github-dark github-light"><code data-language="caddyfile" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span># 1. 경로 방식 — 단일 인증서</span></span>
<span data-line=""><span>store.example.com {</span></span>
<span data-line=""><span>    reverse_proxy localhost:4033</span></span>
<span data-line=""><span>}</span></span>
<span data-line=""> </span>
<span data-line=""><span># 2. 서브도메인 방식 — On-Demand TLS</span></span>
<span data-line=""><span>*.mystore.app {</span></span>
<span data-line=""><span>    tls {</span></span>
<span data-line=""><span>        on_demand</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>    reverse_proxy localhost:4033</span></span>
<span data-line=""><span>}</span></span>
<span data-line=""> </span>
<span data-line=""><span># 3. 커스텀 도메인 방식 — On-Demand TLS</span></span>
<span data-line=""><span>:443 {</span></span>
<span data-line=""><span>    tls {</span></span>
<span data-line=""><span>        on_demand</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>    reverse_proxy localhost:4033</span></span>
<span data-line=""><span>}</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>:443</span></span></code></span> 블록은 위의 어떤 도메인에도 매칭되지 않는 모든 HTTPS 요청을 잡아낸다. <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>on_demand_tls</span></span></code></span>의 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>ask</span></span></code></span> API가 검증을 통과한 도메인만 인증서가 발급된다.</p>
<h3 id="보안-헤더" class="text-2xl font-semibold mt-8 mb-3 text-foreground">보안 헤더</h3>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="caddyfile" data-theme="github-dark github-light"><code data-language="caddyfile" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span>(security_headers) {</span></span>
<span data-line=""><span>    @forbidden {</span></span>
<span data-line=""><span>        path *.env* *.bak *.php.bak *.sql *.log *.ini</span></span>
<span data-line=""><span>        path /storage/* /artisan /config/* /var/log/*</span></span>
<span data-line=""><span>        path /.git* /.htaccess /.htpasswd</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>    respond @forbidden &quot;Access Denied&quot; 403</span></span>
<span data-line=""><span>}</span></span></code></pre></figure>
<h2 id="도메인-검증-api" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">도메인 검증 API</h2>
<p class="my-5 leading-7 text-foreground/90">Caddy가 인증서 발급 전에 호출하는 검증 엔드포인트다.</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span>GET /api/caddy/check-domain?domain=shop.acme.com</span></span>
<span data-line=""> </span>
<span data-line=""><span>200 OK     → 인증서 발급 허용 (DB에 해당 도메인의 테넌트 존재)</span></span>
<span data-line=""><span>404 Not Found → 인증서 발급 거부</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">DB에서 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Tenant.domain</span></span></code></span>이나 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>Tenant.tenantName</span></span></code></span>으로 해당 도메인을 사용하는 테넌트가 있는지 확인한다. 없으면 404를 반환하여 인증서 발급을 차단한다. 이렇게 하면 악의적인 도메인으로 인증서가 남발되는 것을 방지할 수 있다.</p>
<h2 id="nextjs-proxyts에서-도메인-라우팅" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">Next.js proxy.ts에서 도메인 라우팅</h2>
<p class="my-5 leading-7 text-foreground/90">Next.js 16에서는 기존 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>middleware.ts</span></span></code></span>가 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>proxy.ts</span></span></code></span>로 변경되었다. 여기서 서브도메인과 커스텀 도메인 요청을 경로 기반으로 rewrite한다.</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="typescript" data-theme="github-dark github-light"><code data-language="typescript" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">// proxy.ts (Next.js 16)</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> function</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> proxy</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209">request</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> Request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> host</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> request.headers.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">get</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;host&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> url</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1"> URL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(request.url);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">  // 서브도메인 방식: acme.mystore.app → /acme/...</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">  for</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> subdomainHost</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> of</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> SUBDOMAIN_HOSTS</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">) {</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> (host?.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">endsWith</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">`.${</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">subdomainHost</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">)) {</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">      const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> tenantName</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> host.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">replace</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">`.${</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">subdomainHost</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">, </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;&quot;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">);</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">      url.pathname </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">=</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> `/${</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">tenantName</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">}${</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">url</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">.</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">pathname</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">}`</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">;</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">      return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> NextResponse.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">rewrite</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">(url);</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">    }</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">  // 커스텀 도메인 방식: shop.acme.com → DB 조회 → /tenantName/...</span></span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D">  // ...</span></span>
<span data-line=""><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">}</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">이렇게 하면 애플리케이션 내부에서는 항상 <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>app/[tenant]/...</span></span></code></span> 라우트로 통일되어 처리된다.</p>
<h2 id="와일드카드-인증서-cloudflare-dns-연동" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">와일드카드 인증서: Cloudflare DNS 연동</h2>
<p class="my-5 leading-7 text-foreground/90">서브도메인 방식(<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>*.mystore.app</span></span></code></span>)에 와일드카드 인증서가 필요하면, DNS 챌린지를 위해 Cloudflare DNS 플러그인을 포함한 Caddy를 빌드해야 한다.</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="bash" data-theme="github-dark github-light"><code data-language="bash" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># xcaddy로 Cloudflare 플러그인 포함 빌드</span></span>
<span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">go</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> install</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> github.com/caddyserver/xcaddy/cmd/xcaddy@latest</span></span>
<span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">xcaddy</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> build</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> --with</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> github.com/caddy-dns/cloudflare</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">sudo</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> mv</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> caddy</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> /usr/bin/caddy</span></span>
<span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">sudo</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> systemctl</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> restart</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> caddy</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">Caddyfile에서 Cloudflare DNS 프로바이더를 설정한다.</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="caddyfile" data-theme="github-dark github-light"><code data-language="caddyfile" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span>*.mystore.app {</span></span>
<span data-line=""><span>    tls {</span></span>
<span data-line=""><span>        dns cloudflare {env.CF_API_TOKEN}</span></span>
<span data-line=""><span>    }</span></span>
<span data-line=""><span>    reverse_proxy localhost:4033</span></span>
<span data-line=""><span>}</span></span></code></pre></figure>
<p class="my-5 leading-7 text-foreground/90">Cloudflare API 토큰은 systemd 서비스에 환경변수로 주입한다.</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="bash" data-theme="github-dark github-light"><code data-language="bash" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">sudo</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> systemctl</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> edit</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> caddy</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="ini" data-theme="github-dark github-light"><code data-language="ini" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">[Service]</span></span>
<span data-line=""><span style="--shiki-dark:#F97583;--shiki-light:#D73A49">Environment</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E">=</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62">&quot;CF_API_TOKEN=your-cloudflare-api-token&quot;</span></span></code></pre></figure>
<h2 id="배포-pm2--systemd" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">배포: PM2 + systemd</h2>
<p class="my-5 leading-7 text-foreground/90">단일 서버 환경에서는 Docker 없이 Caddy(systemd) + Node.js(PM2) 조합이 간단하다.</p>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="bash" data-theme="github-dark github-light"><code data-language="bash" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># Caddy 설치 (Ubuntu/Debian)</span></span>
<span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">sudo</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> apt</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> install</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> caddy</span></span>
<span data-line=""> </span>
<span data-line=""><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D"># Node.js 앱 시작</span></span>
<span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">pm2</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> start</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> pnpm</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> --name</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> &quot;dps-store&quot;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5"> --</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> start</span></span>
<span data-line=""><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">pm2</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> startup</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E"> &amp;&amp; </span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1">pm2</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62"> save</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure="" class="not-prose my-6"><pre style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff" tabindex="0" data-language="plaintext" data-theme="github-dark github-light"><code data-language="plaintext" data-theme="github-dark github-light" style="display:grid"><span data-line=""><span>/etc/caddy/Caddyfile                  ← Caddy 설정</span></span>
<span data-line=""><span>/var/lib/caddy/.local/share/caddy/    ← SSL 인증서 (자동 관리)</span></span>
<span data-line=""><span>/home/ubuntu/dps-store/               ← Next.js 앱</span></span></code></pre></figure>
<h2 id="주의사항" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">주의사항</h2>
<div class="my-8 overflow-x-auto bg-card rounded-lg border border-border"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">항목</th><th class="border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0">내용</th></tr></thead><tbody><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">Rate Limit</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">Let&#x27;s Encrypt는 주당 50개 인증서 발급 제한. 커스텀 도메인에만 해당</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">도메인 검증</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0"><span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>check-domain</span></span></code></span> API 필수. 없으면 아무 도메인이나 인증서 발급 시도</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">인증서 저장</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">Caddy 데이터 디렉토리 영구 보존 필수 (삭제 시 재발급 필요)</td></tr><tr><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">DNS 전파</td><td class="border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_&amp;]:border-b-0">새 도메인 네임서버 변경 시 최대 48시간 소요</td></tr></tbody></table></div>
<h2 id="마무리" class="text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2">마무리</h2>
<p class="my-5 leading-7 text-foreground/90">Caddy의 On-Demand TLS 덕분에 코드 한 줄 수정 없이 커스텀 도메인을 동적으로 추가할 수 있게 되었다. 핵심은 검증 API(<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff"><span data-line=""><span>/api/caddy/check-domain</span></span></code></span>)를 통해 인증서 발급 대상을 통제하는 것이다.</p>
<p class="my-5 leading-7 text-foreground/90">경로/서브도메인/커스텀 도메인 3가지 방식을 하나의 Caddyfile로 처리하는 구성은, Nginx였다면 상당히 복잡했을 것이다. 멀티테넌트 SaaS를 구축한다면 Caddy + On-Demand TLS 조합을 추천한다.</p></article></div></div><!--$--><!--/$--></div><script>$RB=[];$RV=function(a){$RT=performance.now();for(var b=0;b<a.length;b+=2){var c=a[b],e=a[b+1];null!==e.parentNode&&e.parentNode.removeChild(e);var f=c.parentNode;if(f){var g=c.previousSibling,h=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d||"/&"===d)if(0===h)break;else h--;else"$"!==d&&"$?"!==d&&"$~"!==d&&"$!"!==d&&"&"!==d||h++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;e.firstChild;)f.insertBefore(e.firstChild,c);g.data="$";g._reactRetry&&requestAnimationFrame(g._reactRetry)}}a.length=0};
$RC=function(a,b){if(b=document.getElementById(b))(a=document.getElementById(a))?(a.previousSibling.data="$~",$RB.push(a,b),2===$RB.length&&("number"!==typeof $RT?requestAnimationFrame($RV.bind(null,$RB)):(a=performance.now(),setTimeout($RV.bind(null,$RB),2300>a&&2E3<a?2300-a:$RT+300-a)))):b.parentNode.removeChild(b)};$RC("B:0","S:0")</script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[28739,[\"/_next/static/chunks/94ee590fcdd715f5.js\",\"/_next/static/chunks/cde3ff9ca0393567.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\"],\"Providers\"]\n3:I[63720,[\"/_next/static/chunks/94ee590fcdd715f5.js\",\"/_next/static/chunks/cde3ff9ca0393567.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\"],\"NavBar\"]\n4:I[25270,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n5:I[85455,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n6:I[51506,[\"/_next/static/chunks/94ee590fcdd715f5.js\",\"/_next/static/chunks/cde3ff9ca0393567.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"/_next/static/chunks/bf98b467f5036c3d.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"\"]\n7:I[53013,[\"/_next/static/chunks/94ee590fcdd715f5.js\",\"/_next/static/chunks/cde3ff9ca0393567.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\"],\"default\"]\nc:I[7871,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n:HL[\"/_next/static/chunks/9cf24ed64efb86d5.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"vRd1ViZQsDeRHYuaUNPkZ\",\"c\":[\"\",\"posts\",\"caddy-multi-tenant-ssl\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"caddy-multi-tenant-ssl\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/9cf24ed64efb86d5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/94ee590fcdd715f5.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/cde3ff9ca0393567.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\n  (function() {\\n    try {\\n      var theme = localStorage.getItem('theme');\\n      if (theme === 'dark' || (!theme \u0026\u0026 window.matchMedia('(prefers-color-scheme: dark)').matches)) {\\n        document.documentElement.classList.add('dark');\\n      } else {\\n        document.documentElement.classList.remove('dark');\\n      }\\n    } catch (e) {}\\n  })();\\n\"}}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon-light.svg\"}]]}],[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col bg-background text-foreground antialiased\",\"children\":[[\"$\",\"$L2\",null,{\"children\":[[\"$\",\"$L3\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 flex flex-col\",\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}],[\"$\",\"footer\",null,{\"className\":\"border-t border-border\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-4xl mx-auto px-6 sm:px-8 md:px-12 lg:px-16 py-6 flex flex-col sm:flex-row items-center justify-between gap-2 text-sm text-muted-foreground\",\"children\":[[\"$\",\"span\",null,{\"children\":\"© 2025 anveloper.dev\"}],[\"$\",\"nav\",null,{\"className\":\"flex items-center gap-3\",\"children\":[[\"$\",\"span\",\"GitHub\",{\"className\":\"flex items-center gap-3\",\"children\":[false,[\"$\",\"$L6\",null,{\"href\":\"https://github.com/anveloper\",\"className\":\"hover:text-foreground transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"GitHub\"}]]}],[\"$\",\"span\",\"LinkedIn\",{\"className\":\"flex items-center gap-3\",\"children\":[[\"$\",\"span\",null,{\"aria-hidden\":true,\"children\":\"·\"}],[\"$\",\"$L6\",null,{\"href\":\"https://www.linkedin.com/in/anveloper\",\"className\":\"hover:text-foreground transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"children\":\"LinkedIn\"}]]}],[\"$\",\"span\",\"Contact\",{\"className\":\"flex items-center gap-3\",\"children\":[[\"$\",\"span\",null,{\"aria-hidden\":true,\"children\":\"·\"}],[\"$\",\"$L6\",null,{\"href\":\"/contact\",\"className\":\"hover:text-foreground transition-colors\",\"children\":\"Contact\"}]]}]]}]]}]}]]}],[\"$\",\"$L7\",null,{}]]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,\"$L8\"]}],{\"children\":[\"$L9\",{},null,false,false]},null,false,false]},null,false,false]},[\"$La\",[],[]],false,false],\"$Lb\",false]],\"m\":\"$undefined\",\"G\":[\"$c\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"e:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"OutletBoundary\"]\nf:\"$Sreact.suspense\"\n11:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"ViewportBoundary\"]\n13:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"MetadataBoundary\"]\n8:[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]\n9:[\"$\",\"$1\",\"c\",{\"children\":[\"$Ld\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/bf98b467f5036c3d.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/948615c9ecde1cb4.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/c84805df17f0a72a.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-3\",{\"src\":\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-4\",{\"src\":\"/_next/static/chunks/85806e5b63a62879.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-5\",{\"src\":\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-6\",{\"src\":\"/_next/static/chunks/311bfda68bef2673.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-7\",{\"src\":\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-8\",{\"src\":\"/_next/static/chunks/8fba60bd4135542a.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$Le\",null,{\"children\":[\"$\",\"$f\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@10\"}]}]]}]\na:[\"$\",\"svg\",\"l\",{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"3427ic\",{\"d\":\"M12 2v4\"}],[\"$\",\"path\",\"r700ao\",{\"d\":\"m16.2 7.8 2.9-2.9\"}],[\"$\",\"path\",\"wj9ykh\",{\"d\":\"M18 12h4\"}],[\"$\",\"path\",\"1bxg5t\",{\"d\":\"m16.2 16.2 2.9 2.9\"}],[\"$\",\"path\",\"jadmvz\",{\"d\":\"M12 18v4\"}],[\"$\",\"path\",\"bwix9q\",{\"d\":\"m4.9 19.1 2.9-2.9\"}],[\"$\",\"path\",\"j09sii\",{\"d\":\"M2 12h4\"}],[\"$\",\"path\",\"giyufr\",{\"d\":\"m4.9 4.9 2.9 2.9\"}],\"$undefined\"]}]\nb:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L11\",null,{\"children\":\"$L12\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L13\",null,{\"children\":[\"$\",\"$f\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L14\"}]}]}],null]}]\n"])</script><script>self.__next_f.push([1,"12:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"15:I[66627,[\"/_next/static/chunks/94ee590fcdd715f5.js\",\"/_next/static/chunks/cde3ff9ca0393567.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"/_next/static/chunks/bf98b467f5036c3d.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"TableOfContents\"]\n"])</script><script>self.__next_f.push([1,"d:[\"$\",\"div\",null,{\"className\":\"pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full max-w-4xl mx-auto\",\"children\":[[\"$\",\"$L15\",null,{\"items\":[{\"id\":\"caddy와-on-demand-tls\",\"text\":\"Caddy와 On-Demand TLS\",\"level\":2},{\"id\":\"배경\",\"text\":\"배경\",\"level\":2},{\"id\":\"왜-caddy인가\",\"text\":\"왜 Caddy인가\",\"level\":2},{\"id\":\"아키텍처\",\"text\":\"아키텍처\",\"level\":2},{\"id\":\"caddyfile-설정\",\"text\":\"Caddyfile 설정\",\"level\":2},{\"id\":\"글로벌-설정-on-demand-tls\",\"text\":\"글로벌 설정: On-Demand TLS\",\"level\":3},{\"id\":\"도메인별-블록\",\"text\":\"도메인별 블록\",\"level\":3},{\"id\":\"보안-헤더\",\"text\":\"보안 헤더\",\"level\":3},{\"id\":\"도메인-검증-api\",\"text\":\"도메인 검증 API\",\"level\":2},{\"id\":\"nextjs-proxyts에서-도메인-라우팅\",\"text\":\"Next.js proxy.ts에서 도메인 라우팅\",\"level\":2},{\"id\":\"와일드카드-인증서-cloudflare-dns-연동\",\"text\":\"와일드카드 인증서: Cloudflare DNS 연동\",\"level\":2},{\"id\":\"배포-pm2--systemd\",\"text\":\"배포: PM2 + systemd\",\"level\":2},{\"id\":\"주의사항\",\"text\":\"주의사항\",\"level\":2},{\"id\":\"마무리\",\"text\":\"마무리\",\"level\":2}]}],[\"$\",\"$L6\",null,{\"href\":\"/posts\",\"className\":\"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"포스트 목록으로 돌아가기\"}]]}],[\"$\",\"header\",null,{\"className\":\"border-b border-border pb-6 mb-8\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-2xl sm:text-3xl font-bold text-foreground mb-4\",\"children\":\"Caddy로 멀티테넌트 SSL 자동화하기\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-4 mb-4\",\"children\":[\"$\",\"span\",null,{\"className\":\"text-sm text-muted-foreground\",\"children\":\"2026-01-14\"}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"div\",\"Caddy\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"Caddy\"}],[\"$\",\"div\",\"SSL\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"SSL\"}],[\"$\",\"div\",\"Multi-tenant\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"Multi-tenant\"}],[\"$\",\"div\",\"Infrastructure\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"Infrastructure\"}],[\"$\",\"div\",\"Let's Encrypt\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\"children\":\"Let's Encrypt\"}]]}]]}],[\"$\",\"article\",null,{\"className\":\"prose prose-neutral dark:prose-invert max-w-none\",\"children\":\"$L16\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"10:null\n14:[[\"$\",\"title\",\"0\",{\"children\":\"Caddy로 멀티테넌트 SSL 자동화하기 | 안성진\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"Caddy,SSL,Multi-tenant,Infrastructure,Let's Encrypt\"}],[\"$\",\"meta\",\"3\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"4\",{\"name\":\"google-site-verification\",\"content\":\"kpYkq06WB0cQDLByVOdZD_5HXLkbxzFAvQKQ-Rp9sKY\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Caddy로 멀티테넌트 SSL 자동화하기\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"https://anveloper.dev/posts/caddy-multi-tenant-ssl\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:title\",\"content\":\"Caddy로 멀티테넌트 SSL 자동화하기\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:description\",\"content\":\"On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기\"}]]\n"])</script><script>self.__next_f.push([1,"16:[[\"$\",\"h1\",null,{\"id\":\"caddy로-멀티테넌트-ssl-자동화하기\",\"children\":\"Caddy로 멀티테넌트 SSL 자동화하기\",\"className\":\"text-4xl font-bold mt-10 mb-5 text-foreground\"}],\"\\n\",[\"$\",\"h2\",null,{\"id\":\"caddy와-on-demand-tls\",\"children\":\"Caddy와 On-Demand TLS\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Caddy는 Go로 작성된 웹 서버로, \",[\"$\",\"strong\",null,{\"children\":\"자동 HTTPS\",\"className\":\"font-semibold text-foreground\"}],\"를 최초로 기본 내장한 웹 서버다. Let's Encrypt 공개 이전부터 ACME(Automatic Certificate Management Environment) 프로토콜을 사용해왔으며, 내장 ACME 클라이언트의 안정성과 프로덕션 경험은 현존하는 통합 솔루션 중 가장 풍부하다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Caddy의 핵심 기능 중 하나인 \",[\"$\",\"strong\",null,{\"children\":\"On-Demand TLS\",\"className\":\"font-semibold text-foreground\"}],\"는 설정 파일에 도메인을 미리 등록하지 않아도, TLS 핸드셰이크 시점에 인증서를 동적으로 발급하는 기술이다. 새로운 도메인으로 첫 HTTPS 요청이 들어오면 핸드셰이크를 잠시 보류하고, 검증 API(\",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ask\"}]}]}]}],\" 엔드포인트)를 호출하여 허용 여부를 확인한 뒤 인증서를 자동 발급한다. 이 기능 덕분에 수만 개의 도메인을 동적으로 관리할 수 있어, 멀티테넌트 SaaS의 커스텀 도메인 지원에 적합하다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"기능\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Caddy\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Nginx + certbot\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"HTTPS\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"기본 제공 (Let's Encrypt/ZeroSSL)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"수동 설정 (certbot 별도 설치)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"인증서 갱신\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"자동 (만료 30일 전)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"크론잡 필요\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"동적 도메인\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"On-Demand TLS (핸드셰이크 시점 발급)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"설정 수정 + reload 필요\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"ACME 챌린지\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HTTP, TLS-ALPN, DNS 모두 지원\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"HTTP만 기본, DNS는 별도 플러그인\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],\"$L17\"]}]]}]}],\"\\n\",\"$L18\",\"\\n\",\"$L19\",\"\\n\",\"$L1a\",\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\",\"\\n\",\"$L3f\",\"\\n\",\"$L40\",\"\\n\",\"$L41\",\"\\n\",\"$L42\",\"\\n\",\"$L43\"]\n"])</script><script>self.__next_f.push([1,"44:I[63508,[\"/_next/static/chunks/94ee590fcdd715f5.js\",\"/_next/static/chunks/cde3ff9ca0393567.js\",\"/_next/static/chunks/fec9c5c27cbc91d6.js\",\"/_next/static/chunks/bf98b467f5036c3d.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/0e5a02cd06292d2b.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"Mermaid\"]\n17:[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"OCSP Stapling\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"자동\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"수동 설정\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]\n18:[\"$\",\"p\",null,{\"children\":\"이 글에서는 Caddy의 On-Demand TLS를 활용하여 멀티테넌트 플랫폼에서 경로/서브도메인/커스텀 도메인 3가지 방식의 SSL을 하나의 Caddyfile로 자동화한 과정을 정리한다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n19:[\"$\",\"h2\",null,{\"id\":\"배경\",\"children\":\"배경\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n1a:[\"$\",\"p\",null,{\"children\":\"멀티테넌트 스토어 플랫폼에서 3가지 도메인 방식을 지원해야 했다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"방식\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"예시\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"SSL 인증서\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"경로\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"store.example.com/acme\"}]}]}]}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"단일 인증서\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"서브도메인\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"acme.mystore.app\"}]}]}]}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"와일드카드 인증서\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"커스텀 도메인\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"shop.acme.com\"}]}]}]}],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"개별 인증서 (동적)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"1c:[\"$\",\"p\",null,{\"children\":\"핵심 문제는 커스텀 도메인이다. 테넌트가 언제든 자신의 도메인을 연결할 수 있어야 하고, SSL 인증서가 자동으로 발급·갱신되어야 한다. Nginx + certbot 조합으로는 새 도메인을 추가할 때마다 설정 파일을 수정하고 reload해야 하는 번거로움이 있었다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n1d:[\"$\",\"h2\",null,{\"id\":\"왜-caddy인가\",\"children\":\"왜 Caddy인가\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n"])</script><script>self.__next_f.push([1,"1e:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"기능\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Caddy\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"Nginx\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"HTTPS\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"기본 제공 (Let's Encrypt)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"수동 설정 (certbot)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"인증서 갱신\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"자동\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"크론잡 필요\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"동적 도메인 추가\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"API로 즉시 반영\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"설정 수정 + reload\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"설정 복잡도\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"간단\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"복잡\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"1f:[\"$\",\"p\",null,{\"children\":[\"Caddy의 \",[\"$\",\"strong\",null,{\"children\":\"On-Demand TLS\",\"className\":\"font-semibold text-foreground\"}],\"가 결정적이었다. 설정 파일 수정 없이, 새로운 도메인으로 요청이 들어오면 검증 API를 호출하고 통과하면 자동으로 인증서를 발급한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n20:[\"$\",\"h2\",null,{\"id\":\"아키텍처\",\"children\":\"아키텍처\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n21:[\"$\",\"$L44\",null,{\"chart\":\"flowchart TD\\n  User[사용자] --\u003e|\u0026quot;store.example.com/acme (경로)\\\\nacme.mystore.app (서브도메인)\\\\nshop.acme.com (커스텀 도메인)\u0026quot;| Caddy\\n\\n  Caddy[\u0026quot;Caddy — 443 (HTTPS)\\\\n경로: 단일 인증서\\\\n서브도메인: 와일드카드\\\\n커스텀 도메인: On-Demand TLS\u0026quot;] --\u003e Next[\u0026quot;Next.js 앱 — 4033 (내부)\\\\nHost 헤더 + 경로로 테넌트 식별\u0026quot;]\\n\\n  Next --\u003e DB[Database]\"}]\n22:[\"$\",\"h2\",null,{\"id\":\"caddyfile-설정\",\"children\":\"Caddyfile 설정\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n23:[\"$\",\"h3\",null,{\"id\":\"글로벌-설정-on-demand-tls\",\"children\":\"글로벌 설정: On-Demand TLS\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n24:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"{\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    on_demand_tls {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        ask http://localhost:4033/api/caddy/check-domain\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"}\"}]}]]}]}],\"className\":\"not-prose my-6\"}]\n25:[\"$\",\"p\",null,{\"children\":[[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ask\"}]}]}]}],\" 디렉티브가 핵심이다. 새로운 도메인으로 HTTPS 요청이 들어올 때마다, Caddy가 이 URL을 호출하여 인증서를 발급해도 되는지 확인한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n26:[\"$\",\"h3\",null,{\"id\":\"도메인별-블록\",\"children\":\"도메인별 블록\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n"])</script><script>self.__next_f.push([1,"27:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"# 1. 경로 방식 — 단일 인증서\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"store.example.com {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    reverse_proxy localhost:4033\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"# 2. 서브도메인 방식 — On-Demand TLS\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"*.mystore.app {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    tls {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        on_demand\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    reverse_proxy localhost:4033\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"# 3. 커스텀 도메인 방식 — On-Demand TLS\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\":443 {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    tls {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        on_demand\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    reverse_proxy localhost:4033\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"}\"}]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"28:[\"$\",\"p\",null,{\"children\":[[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\":443\"}]}]}]}],\" 블록은 위의 어떤 도메인에도 매칭되지 않는 모든 HTTPS 요청을 잡아낸다. \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"on_demand_tls\"}]}]}]}],\"의 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ask\"}]}]}]}],\" API가 검증을 통과한 도메인만 인증서가 발급된다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n29:[\"$\",\"h3\",null,{\"id\":\"보안-헤더\",\"children\":\"보안 헤더\",\"className\":\"text-2xl font-semibold mt-8 mb-3 text-foreground\"}]\n2a:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"(security_headers) {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    @forbidden {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        path *.env* *.bak *.php.bak *.sql *.log *.ini\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        path /storage/* /artisan /config/* /var/log/*\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        path /.git* /.htaccess /.htpasswd\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    respond @forbidden \\\"Access Denied\\\" 403\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"}\"}]}]]}]}],\"className\":\"not-prose my-6\"}]\n2b:[\"$\",\"h2\",null,{\"id\":\"도메인-검증-api\",\"children\":\"도메인 검증 API\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n2c:[\"$\",\"p\",null,{\"children\":\"Caddy가 인증서 발급 전에 호출하는 검증 엔드포인트다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n2d:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"GET /api/caddy/check-domain?domain=shop.acme.com\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"200 OK     → 인증서 발급 허용 (DB에 해당 도메인의 테넌트 존재)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"404 Not Found → 인증서 발급 거부\"}]}]]}]}],\"class"])</script><script>self.__next_f.push([1,"Name\":\"not-prose my-6\"}]\n2e:[\"$\",\"p\",null,{\"children\":[\"DB에서 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Tenant.domain\"}]}]}]}],\"이나 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Tenant.tenantName\"}]}]}]}],\"으로 해당 도메인을 사용하는 테넌트가 있는지 확인한다. 없으면 404를 반환하여 인증서 발급을 차단한다. 이렇게 하면 악의적인 도메인으로 인증서가 남발되는 것을 방지할 수 있다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n2f:[\"$\",\"h2\",null,{\"id\":\"nextjs-proxyts에서-도메인-라우팅\",\"children\":\"Next.js proxy.ts에서 도메인 라우팅\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n30:[\"$\",\"p\",null,{\"children\":[\"Next.js 16에서는 기존 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"middleware.ts\"}]}]}]}],\"가 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"proxy.ts\"}]}]}]}],\"로 변경되었다. 여기서 서브도메인과 커스텀 도메인 요청을 경로 기반으로 rewrite한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"31:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"typescript\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"typescript\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"// proxy.ts (Next.js 16)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"export\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" proxy\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#FFAB70\",\"--shiki-light\":\"#E36209\"},\"children\":\"request\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" Request\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" host\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" request.headers.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"host\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" url\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(request.url);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"  // 서브도메인 방식: acme.mystore.app → /acme/...\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"  for\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" subdomainHost\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" of\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" SUBDOMAIN_HOSTS\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" (host?.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"endsWith\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`.${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"subdomainHost\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\")) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$L45\",\"$L46\",\"$L47\",\"$L48\",\"$L49\",\"$L4a\",\"$L4b\",\"$L4c\",\"$L4d\",\"$L4e\",\"$L4f\",\"$L50\"]}],\"\\n\",\"$L51\",\"\\n\",\"$L52\",\"\\n\",\"$L53\",\"\\n\",\"$L54\",\"\\n\",\"$L55\",\"\\n\",\"$L56\",\"\\n\",\"$L57\",\"\\n\",\"$L58\"]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"32:[\"$\",\"p\",null,{\"children\":[\"이렇게 하면 애플리케이션 내부에서는 항상 \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"app/[tenant]/...\"}]}]}]}],\" 라우트로 통일되어 처리된다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n33:[\"$\",\"h2\",null,{\"id\":\"와일드카드-인증서-cloudflare-dns-연동\",\"children\":\"와일드카드 인증서: Cloudflare DNS 연동\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n34:[\"$\",\"p\",null,{\"children\":[\"서브도메인 방식(\",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"*.mystore.app\"}]}]}]}],\")에 와일드카드 인증서가 필요하면, DNS 챌린지를 위해 Cloudflare DNS 플러그인을 포함한 Caddy를 빌드해야 한다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"35:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"# xcaddy로 Cloudflare 플러그인 포함 빌드\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"go\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" install\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" github.com/caddyserver/xcaddy/cmd/xcaddy@latest\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"xcaddy\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" build\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" --with\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" github.com/caddy-dns/cloudflare\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"sudo\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" mv\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" caddy\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" /usr/bin/caddy\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"sudo\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" systemctl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" restart\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" caddy\"}]]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"36:[\"$\",\"p\",null,{\"children\":\"Caddyfile에서 Cloudflare DNS 프로바이더를 설정한다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n37:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"caddyfile\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"*.mystore.app {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    tls {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        dns cloudflare {env.CF_API_TOKEN}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    reverse_proxy localhost:4033\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"}\"}]}]]}]}],\"className\":\"not-prose my-6\"}]\n38:[\"$\",\"p\",null,{\"children\":\"Cloudflare API 토큰은 systemd 서비스에 환경변수로 주입한다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n39:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"sudo\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" systemctl\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" edit\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" caddy\"}]]}]}]}],\"className\":\"not-prose my-6\"}]\n3a:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"ini\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"ini\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"[Service]\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"Environment\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"CF_API_TOKEN=your-cloudflare-api-token\\\"\"}]]}]]}]}],\"className\":\"not-prose my-6\"}]\n3b:[\"$\",\"h2\",null,{\"id\":\"배포-pm2--systemd\",\"children\":\"배포: PM2 + systemd\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n3c:[\"$\",\"p\",null,{\"children\":\"단일 서버 환경에서는 Docker 없이 Caddy(systemd) + Node.js(PM2) 조합이 간단하다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"3d:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"bash\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"bash\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"# Caddy 설치 (Ubuntu/Debian)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"sudo\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" apt\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" install\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" caddy\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"# Node.js 앱 시작\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"pm2\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" start\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" pnpm\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" --name\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" \\\"dps-store\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" --\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" start\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"pm2\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" startup\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" \u0026\u0026 \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"pm2\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" save\"}]]}]]}]}],\"className\":\"not-prose my-6\"}]\n"])</script><script>self.__next_f.push([1,"3e:[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"/etc/caddy/Caddyfile                  ← Caddy 설정\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"/var/lib/caddy/.local/share/caddy/    ← SSL 인증서 (자동 관리)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"/home/ubuntu/dps-store/               ← Next.js 앱\"}]}]]}]}],\"className\":\"not-prose my-6\"}]\n3f:[\"$\",\"h2\",null,{\"id\":\"주의사항\",\"children\":\"주의사항\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n"])</script><script>self.__next_f.push([1,"40:[\"$\",\"div\",null,{\"className\":\"my-8 overflow-x-auto bg-card rounded-lg border border-border\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"항목\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}],[\"$\",\"th\",null,{\"children\":\"내용\",\"className\":\"border-b border-r border-border px-4 py-2 text-left font-semibold last:border-r-0\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Rate Limit\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"Let's Encrypt는 주당 50개 인증서 발급 제한. 커스텀 도메인에만 해당\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"도메인 검증\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":[[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"check-domain\"}]}]}]}],\" API 필수. 없으면 아무 도메인이나 인증서 발급 시도\"],\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"인증서 저장\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"Caddy 데이터 디렉토리 영구 보존 필수 (삭제 시 재발급 필요)\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"DNS 전파\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}],[\"$\",\"td\",null,{\"children\":\"새 도메인 네임서버 변경 시 최대 48시간 소요\",\"className\":\"border-b border-r border-border px-4 py-2 last:border-r-0 [tr:last-child_\u0026]:border-b-0\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"41:[\"$\",\"h2\",null,{\"id\":\"마무리\",\"children\":\"마무리\",\"className\":\"text-3xl font-semibold mt-9 mb-4 text-foreground border-b border-border pb-2\"}]\n42:[\"$\",\"p\",null,{\"children\":[\"Caddy의 On-Demand TLS 덕분에 코드 한 줄 수정 없이 커스텀 도메인을 동적으로 추가할 수 있게 되었다. 핵심은 검증 API(\",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark github-light\",\"style\":{\"--shiki-dark\":\"#e1e4e8\",\"--shiki-light\":\"#24292e\",\"--shiki-dark-bg\":\"#24292e\",\"--shiki-light-bg\":\"#fff\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"/api/caddy/check-domain\"}]}]}]}],\")를 통해 인증서 발급 대상을 통제하는 것이다.\"],\"className\":\"my-5 leading-7 text-foreground/90\"}]\n43:[\"$\",\"p\",null,{\"children\":\"경로/서브도메인/커스텀 도메인 3가지 방식을 하나의 Caddyfile로 처리하는 구성은, Nginx였다면 상당히 복잡했을 것이다. 멀티테넌트 SaaS를 구축한다면 Caddy + On-Demand TLS 조합을 추천한다.\",\"className\":\"my-5 leading-7 text-foreground/90\"}]\n"])</script><script>self.__next_f.push([1,"45:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"      const\"}]\n46:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#79B8FF\",\"--shiki-light\":\"#005CC5\"},\"children\":\" tenantName\"}]\n47:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\" =\"}]\n48:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" host.\"}]\n49:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"replace\"}]\n4a:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(\"}]\n4b:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"`.${\"}]\n4c:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"subdomainHost\"}]\n4d:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}]\n4e:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\", \"}]\n4f:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"\\\"\\\"\"}]\n50:[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\");\"}]\n51:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"      url.pathname \"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\" `/${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"tenantName\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}${\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"url\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"pathname\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#9ECBFF\",\"--shiki-light\":\"#032F62\"},\"children\":\"}`\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\";\"}]]}]\n52:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#F97583\",\"--shiki-light\":\"#D73A49\"},\"children\":\"      return\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\" NextResponse.\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#B392F0\",\"--shiki-light\":\"#6F42C1\"},\"children\":\"rewrite\"}],[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"(url);\"}]]}]\n53:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"    }\"}]}]\n54:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"  }\"}]}]\n55:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]\n56:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"  // 커스텀 도메인 방식: shop.acme.com → DB 조회 → /tenantName/...\"}]}]\n57:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#6A737D\",\"--shiki-light\":\"#6A737D\"},\"children\":\"  // ...\"}]}]\n58:[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"--shiki-dark\":\"#E1E4E8\",\"--shiki-light\":\"#24292E\"},\"children\":\"}\"}]}]\n"])</script></body></html>