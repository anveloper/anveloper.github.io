<!DOCTYPE html><!--xtL_OUEB20H71FD7GVs3v--><html lang="ko"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/d00d57982c625756.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/a21146379db92032.js"/><script src="/_next/static/chunks/1e278fdde29a4b5a.js" async=""></script><script src="/_next/static/chunks/2e19ce224f1f9d89.js" async=""></script><script src="/_next/static/chunks/a0f43a3390939b7e.js" async=""></script><script src="/_next/static/chunks/turbopack-0062a60ab2ca90b2.js" async=""></script><script src="/_next/static/chunks/24ec601050a34de4.js" async=""></script><script src="/_next/static/chunks/44aea766f6f80a25.js" async=""></script><script src="/_next/static/chunks/f0d2ef03bc5b3146.js" async=""></script><script src="/_next/static/chunks/221e0744b683f94b.js" async=""></script><script src="/_next/static/chunks/90c5a27ffb71fa4a.js" async=""></script><script src="/_next/static/chunks/9a18b7330d276141.js" async=""></script><script src="/_next/static/chunks/a3d20a812be16d69.js" async=""></script><script src="/_next/static/chunks/c84805df17f0a72a.js" async=""></script><script src="/_next/static/chunks/948615c9ecde1cb4.js" async=""></script><script src="/_next/static/chunks/85806e5b63a62879.js" async=""></script><script src="/_next/static/chunks/311bfda68bef2673.js" async=""></script><script src="/_next/static/chunks/f87ca1afb6e89cb0.js" async=""></script><script src="/_next/static/chunks/e1a9aaa3e8d4ba89.js" async=""></script><script src="/_next/static/chunks/8fba60bd4135542a.js" async=""></script><link rel="shortcut icon" href="/favicon-light.svg"/><link rel="icon" href="/favicon-light.svg"/><link rel="apple-touch-icon" href="/favicon-light.svg"/><title>Caddy로 멀티테넌트 SSL 자동화하기 | 안성진</title><meta name="description" content="On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기"/><meta name="keywords" content="Caddy,SSL,Multi-tenant,Infrastructure,Let&#x27;s Encrypt"/><meta name="robots" content="index, follow"/><meta property="og:title" content="Caddy로 멀티테넌트 SSL 자동화하기"/><meta property="og:description" content="On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기"/><meta property="og:url" content="https://anveloper.github.io/posts/caddy-multi-tenant-ssl"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Caddy로 멀티테넌트 SSL 자동화하기"/><meta name="twitter:description" content="On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기"/><script>
  (function() {
    try {
      var theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    } catch (e) {}
  })();
</script><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen flex flex-col bg-background text-foreground antialiased"><div hidden=""><!--$--><!--/$--></div><main class="flex-1 flex flex-col"><!--$?--><template id="B:0"></template><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50" aria-hidden="true"><path d="M12 2v4"></path><path d="m16.2 7.8 2.9-2.9"></path><path d="M18 12h4"></path><path d="m16.2 16.2 2.9 2.9"></path><path d="M12 18v4"></path><path d="m4.9 19.1 2.9-2.9"></path><path d="M2 12h4"></path><path d="m4.9 4.9 2.9 2.9"></path></svg><!--/$--></main><script>requestAnimationFrame(function(){$RT=performance.now()});</script><script src="/_next/static/chunks/a21146379db92032.js" id="_R_" async=""></script><div hidden id="S:0"><div class="pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen bg-[radial-gradient(oklch(0.5_0_0/15%)_1px,transparent_1px)] bg-size-[20px_20px]"><div class="w-full max-w-4xl mx-auto"><a class="inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6" href="/posts"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left w-4 h-4" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg><span>포스트 목록으로 돌아가기</span></a><div class="rounded-lg border border-border bg-card text-card-foreground shadow-sm mb-8"><div class="p-6 pt-6"><h1 class="text-3xl sm:text-4xl font-bold text-foreground mb-4">Caddy로 멀티테넌트 SSL 자동화하기</h1><div class="flex flex-wrap items-center gap-4 mb-4"><div class="flex items-center gap-2 text-muted-foreground"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar w-4 h-4" aria-hidden="true"><path d="M8 2v4"></path><path d="M16 2v4"></path><rect width="18" height="18" x="3" y="4" rx="2"></rect><path d="M3 10h18"></path></svg><span>2026-01-14</span></div></div><div class="flex flex-wrap gap-2"><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">Caddy</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">SSL</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">Multi-tenant</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">Infrastructure</div><div class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky">Let&#x27;s Encrypt</div></div></div></div><article class="prose prose-neutral dark:prose-invert max-w-none"><h1 class="text-4xl font-bold mt-8 mb-4 text-foreground">Caddy로 멀티테넌트 SSL 자동화하기</h1>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">배경</h2>
<p class="my-4 leading-7 text-foreground/90">멀티테넌트 스토어 플랫폼에서 3가지 도메인 방식을 지원해야 했다.</p>
<div class="my-6 overflow-x-auto"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border border-border px-4 py-2 text-left font-semibold">방식</th><th class="border border-border px-4 py-2 text-left font-semibold">예시</th><th class="border border-border px-4 py-2 text-left font-semibold">SSL 인증서</th></tr></thead><tbody><tr><td class="border border-border px-4 py-2">경로</td><td class="border border-border px-4 py-2"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">store.example.com/acme</code></td><td class="border border-border px-4 py-2">단일 인증서</td></tr><tr><td class="border border-border px-4 py-2">서브도메인</td><td class="border border-border px-4 py-2"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">acme.mystore.app</code></td><td class="border border-border px-4 py-2">와일드카드 인증서</td></tr><tr><td class="border border-border px-4 py-2">커스텀 도메인</td><td class="border border-border px-4 py-2"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">shop.acme.com</code></td><td class="border border-border px-4 py-2">개별 인증서 (동적)</td></tr></tbody></table></div>
<p class="my-4 leading-7 text-foreground/90">핵심 문제는 커스텀 도메인이다. 테넌트가 언제든 자신의 도메인을 연결할 수 있어야 하고, SSL 인증서가 자동으로 발급·갱신되어야 한다. Nginx + certbot 조합으로는 새 도메인을 추가할 때마다 설정 파일을 수정하고 reload해야 하는 번거로움이 있었다.</p>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">왜 Caddy인가</h2>
<div class="my-6 overflow-x-auto"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border border-border px-4 py-2 text-left font-semibold">기능</th><th class="border border-border px-4 py-2 text-left font-semibold">Caddy</th><th class="border border-border px-4 py-2 text-left font-semibold">Nginx</th></tr></thead><tbody><tr><td class="border border-border px-4 py-2">HTTPS</td><td class="border border-border px-4 py-2">기본 제공 (Let&#x27;s Encrypt)</td><td class="border border-border px-4 py-2">수동 설정 (certbot)</td></tr><tr><td class="border border-border px-4 py-2">인증서 갱신</td><td class="border border-border px-4 py-2">자동</td><td class="border border-border px-4 py-2">크론잡 필요</td></tr><tr><td class="border border-border px-4 py-2">동적 도메인 추가</td><td class="border border-border px-4 py-2">API로 즉시 반영</td><td class="border border-border px-4 py-2">설정 수정 + reload</td></tr><tr><td class="border border-border px-4 py-2">설정 복잡도</td><td class="border border-border px-4 py-2">간단</td><td class="border border-border px-4 py-2">복잡</td></tr></tbody></table></div>
<p class="my-4 leading-7 text-foreground/90">Caddy의 <strong class="font-semibold text-foreground">On-Demand TLS</strong>가 결정적이었다. 설정 파일 수정 없이, 새로운 도메인으로 요청이 들어오면 검증 API를 호출하고 통과하면 자동으로 인증서를 발급한다.</p>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">아키텍처</h2>
<div class="my-6 flex justify-center overflow-x-auto [&amp;_svg]:max-w-full"></div>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">Caddyfile 설정</h2>
<h3 class="text-2xl font-semibold mt-5 mb-2 text-foreground">글로벌 설정: On-Demand TLS</h3>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">{
    on_demand_tls {
        ask http://localhost:4033/api/caddy/check-domain
    }
}
</code></pre>
<p class="my-4 leading-7 text-foreground/90"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">ask</code> 디렉티브가 핵심이다. 새로운 도메인으로 HTTPS 요청이 들어올 때마다, Caddy가 이 URL을 호출하여 인증서를 발급해도 되는지 확인한다.</p>
<h3 class="text-2xl font-semibold mt-5 mb-2 text-foreground">도메인별 블록</h3>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground"># 1. 경로 방식 — 단일 인증서
store.example.com {
    reverse_proxy localhost:4033
}

# 2. 서브도메인 방식 — On-Demand TLS
*.mystore.app {
    tls {
        on_demand
    }
    reverse_proxy localhost:4033
}

# 3. 커스텀 도메인 방식 — On-Demand TLS
:443 {
    tls {
        on_demand
    }
    reverse_proxy localhost:4033
}
</code></pre>
<p class="my-4 leading-7 text-foreground/90"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">:443</code> 블록은 위의 어떤 도메인에도 매칭되지 않는 모든 HTTPS 요청을 잡아낸다. <code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">on_demand_tls</code>의 <code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">ask</code> API가 검증을 통과한 도메인만 인증서가 발급된다.</p>
<h3 class="text-2xl font-semibold mt-5 mb-2 text-foreground">보안 헤더</h3>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">(security_headers) {
    @forbidden {
        path *.env* *.bak *.php.bak *.sql *.log *.ini
        path /storage/* /artisan /config/* /var/log/*
        path /.git* /.htaccess /.htpasswd
    }
    respond @forbidden &quot;Access Denied&quot; 403
}
</code></pre>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">도메인 검증 API</h2>
<p class="my-4 leading-7 text-foreground/90">Caddy가 인증서 발급 전에 호출하는 검증 엔드포인트다.</p>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">GET /api/caddy/check-domain?domain=shop.acme.com

200 OK     → 인증서 발급 허용 (DB에 해당 도메인의 테넌트 존재)
404 Not Found → 인증서 발급 거부
</code></pre>
<p class="my-4 leading-7 text-foreground/90">DB에서 <code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">Tenant.domain</code>이나 <code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">Tenant.tenantName</code>으로 해당 도메인을 사용하는 테넌트가 있는지 확인한다. 없으면 404를 반환하여 인증서 발급을 차단한다. 이렇게 하면 악의적인 도메인으로 인증서가 남발되는 것을 방지할 수 있다.</p>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">Next.js proxy.ts에서 도메인 라우팅</h2>
<p class="my-4 leading-7 text-foreground/90">Next.js 16에서는 기존 <code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">middleware.ts</code>가 <code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">proxy.ts</code>로 변경되었다. 여기서 서브도메인과 커스텀 도메인 요청을 경로 기반으로 rewrite한다.</p>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">// proxy.ts (Next.js 16)
export function proxy(request: Request) {
  const host = request.headers.get(&quot;host&quot;);
  const url = new URL(request.url);

  // 서브도메인 방식: acme.mystore.app → /acme/...
  for (const subdomainHost of SUBDOMAIN_HOSTS) {
    if (host?.endsWith(`.${subdomainHost}`)) {
      const tenantName = host.replace(`.${subdomainHost}`, &quot;&quot;);
      url.pathname = `/${tenantName}${url.pathname}`;
      return NextResponse.rewrite(url);
    }
  }

  // 커스텀 도메인 방식: shop.acme.com → DB 조회 → /tenantName/...
  // ...
}
</code></pre>
<p class="my-4 leading-7 text-foreground/90">이렇게 하면 애플리케이션 내부에서는 항상 <code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">app/[tenant]/...</code> 라우트로 통일되어 처리된다.</p>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">와일드카드 인증서: Cloudflare DNS 연동</h2>
<p class="my-4 leading-7 text-foreground/90">서브도메인 방식(<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">*.mystore.app</code>)에 와일드카드 인증서가 필요하면, DNS 챌린지를 위해 Cloudflare DNS 플러그인을 포함한 Caddy를 빌드해야 한다.</p>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground"># xcaddy로 Cloudflare 플러그인 포함 빌드
go install github.com/caddyserver/xcaddy/cmd/xcaddy@latest
xcaddy build --with github.com/caddy-dns/cloudflare

sudo mv caddy /usr/bin/caddy
sudo systemctl restart caddy
</code></pre>
<p class="my-4 leading-7 text-foreground/90">Caddyfile에서 Cloudflare DNS 프로바이더를 설정한다.</p>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">*.mystore.app {
    tls {
        dns cloudflare {env.CF_API_TOKEN}
    }
    reverse_proxy localhost:4033
}
</code></pre>
<p class="my-4 leading-7 text-foreground/90">Cloudflare API 토큰은 systemd 서비스에 환경변수로 주입한다.</p>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">sudo systemctl edit caddy
</code></pre>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">[Service]
Environment=&quot;CF_API_TOKEN=your-cloudflare-api-token&quot;
</code></pre>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">배포: PM2 + systemd</h2>
<p class="my-4 leading-7 text-foreground/90">단일 서버 환경에서는 Docker 없이 Caddy(systemd) + Node.js(PM2) 조합이 간단하다.</p>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground"># Caddy 설치 (Ubuntu/Debian)
sudo apt install caddy

# Node.js 앱 시작
pm2 start pnpm --name &quot;dps-store&quot; -- start
pm2 startup &amp;&amp; pm2 save
</code></pre>
<pre class="bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">/etc/caddy/Caddyfile                  ← Caddy 설정
/var/lib/caddy/.local/share/caddy/    ← SSL 인증서 (자동 관리)
/home/ubuntu/dps-store/               ← Next.js 앱
</code></pre>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">주의사항</h2>
<div class="my-6 overflow-x-auto"><table class="w-full border-collapse"><thead class="bg-muted"><tr><th class="border border-border px-4 py-2 text-left font-semibold">항목</th><th class="border border-border px-4 py-2 text-left font-semibold">내용</th></tr></thead><tbody><tr><td class="border border-border px-4 py-2">Rate Limit</td><td class="border border-border px-4 py-2">Let&#x27;s Encrypt는 주당 50개 인증서 발급 제한. 커스텀 도메인에만 해당</td></tr><tr><td class="border border-border px-4 py-2">도메인 검증</td><td class="border border-border px-4 py-2"><code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">check-domain</code> API 필수. 없으면 아무 도메인이나 인증서 발급 시도</td></tr><tr><td class="border border-border px-4 py-2">인증서 저장</td><td class="border border-border px-4 py-2">Caddy 데이터 디렉토리 영구 보존 필수 (삭제 시 재발급 필요)</td></tr><tr><td class="border border-border px-4 py-2">DNS 전파</td><td class="border border-border px-4 py-2">새 도메인 네임서버 변경 시 최대 48시간 소요</td></tr></tbody></table></div>
<h2 class="text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2">마무리</h2>
<p class="my-4 leading-7 text-foreground/90">Caddy의 On-Demand TLS 덕분에 코드 한 줄 수정 없이 커스텀 도메인을 동적으로 추가할 수 있게 되었다. 핵심은 검증 API(<code class="bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground">/api/caddy/check-domain</code>)를 통해 인증서 발급 대상을 통제하는 것이다.</p>
<p class="my-4 leading-7 text-foreground/90">경로/서브도메인/커스텀 도메인 3가지 방식을 하나의 Caddyfile로 처리하는 구성은, Nginx였다면 상당히 복잡했을 것이다. 멀티테넌트 SaaS를 구축한다면 Caddy + On-Demand TLS 조합을 추천한다.</p></article></div></div><!--$--><!--/$--></div><script>$RB=[];$RV=function(a){$RT=performance.now();for(var b=0;b<a.length;b+=2){var c=a[b],e=a[b+1];null!==e.parentNode&&e.parentNode.removeChild(e);var f=c.parentNode;if(f){var g=c.previousSibling,h=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d||"/&"===d)if(0===h)break;else h--;else"$"!==d&&"$?"!==d&&"$~"!==d&&"$!"!==d&&"&"!==d||h++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;e.firstChild;)f.insertBefore(e.firstChild,c);g.data="$";g._reactRetry&&requestAnimationFrame(g._reactRetry)}}a.length=0};
$RC=function(a,b){if(b=document.getElementById(b))(a=document.getElementById(a))?(a.previousSibling.data="$~",$RB.push(a,b),2===$RB.length&&("number"!==typeof $RT?requestAnimationFrame($RV.bind(null,$RB)):(a=performance.now(),setTimeout($RV.bind(null,$RB),2300>a&&2E3<a?2300-a:$RT+300-a)))):b.parentNode.removeChild(b)};$RC("B:0","S:0")</script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[28739,[\"/_next/static/chunks/24ec601050a34de4.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/f0d2ef03bc5b3146.js\"],\"Providers\"]\n3:I[63720,[\"/_next/static/chunks/24ec601050a34de4.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/f0d2ef03bc5b3146.js\"],\"NavBar\"]\n4:I[25270,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n5:I[85455,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n6:I[53013,[\"/_next/static/chunks/24ec601050a34de4.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/f0d2ef03bc5b3146.js\"],\"default\"]\n8:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"OutletBoundary\"]\n9:\"$Sreact.suspense\"\n14:I[7871,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"default\"]\n:HL[\"/_next/static/chunks/d00d57982c625756.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"xtL-OUEB20H71FD7GVs3v\",\"c\":[\"\",\"posts\",\"caddy-multi-tenant-ssl\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"caddy-multi-tenant-ssl\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/d00d57982c625756.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/24ec601050a34de4.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/44aea766f6f80a25.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/f0d2ef03bc5b3146.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"ko\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"script\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"\\n  (function() {\\n    try {\\n      var theme = localStorage.getItem('theme');\\n      if (theme === 'dark' || (!theme \u0026\u0026 window.matchMedia('(prefers-color-scheme: dark)').matches)) {\\n        document.documentElement.classList.add('dark');\\n      } else {\\n        document.documentElement.classList.remove('dark');\\n      }\\n    } catch (e) {}\\n  })();\\n\"}}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/favicon-light.svg\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"href\":\"/favicon-light.svg\"}]]}],[\"$\",\"body\",null,{\"className\":\"min-h-screen flex flex-col bg-background text-foreground antialiased\",\"children\":[[\"$\",\"$L2\",null,{\"children\":[[\"$\",\"$L3\",null,{}],[\"$\",\"main\",null,{\"className\":\"flex-1 flex flex-col\",\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],[\"$\",\"$L6\",null,{}]]}]]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[\"$L7\",[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/9a18b7330d276141.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-1\",{\"src\":\"/_next/static/chunks/a3d20a812be16d69.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-2\",{\"src\":\"/_next/static/chunks/c84805df17f0a72a.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-3\",{\"src\":\"/_next/static/chunks/948615c9ecde1cb4.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-4\",{\"src\":\"/_next/static/chunks/85806e5b63a62879.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-5\",{\"src\":\"/_next/static/chunks/311bfda68bef2673.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-6\",{\"src\":\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-7\",{\"src\":\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"async\":true,\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-8\",{\"src\":\"/_next/static/chunks/8fba60bd4135542a.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L8\",null,{\"children\":[\"$\",\"$9\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@a\"}]}]]}],{},null,false,false]},null,false,false]},null,false,false]},[[\"$\",\"svg\",\"l\",{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-loader h-11 w-11 absolute m-auto top-0 bottom-0 right-0 left-0 animate-spin text-muted-foreground z-50\",\"aria-hidden\":\"true\",\"children\":[\"$Lb\",\"$Lc\",\"$Ld\",\"$Le\",\"$Lf\",\"$L10\",\"$L11\",\"$L12\",\"$undefined\"]}],[],[]],false,false],\"$L13\",false]],\"m\":\"$undefined\",\"G\":[\"$14\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"15:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"ViewportBoundary\"]\n17:I[95276,[\"/_next/static/chunks/221e0744b683f94b.js\",\"/_next/static/chunks/90c5a27ffb71fa4a.js\"],\"MetadataBoundary\"]\nb:[\"$\",\"path\",\"3427ic\",{\"d\":\"M12 2v4\"}]\nc:[\"$\",\"path\",\"r700ao\",{\"d\":\"m16.2 7.8 2.9-2.9\"}]\nd:[\"$\",\"path\",\"wj9ykh\",{\"d\":\"M18 12h4\"}]\ne:[\"$\",\"path\",\"1bxg5t\",{\"d\":\"m16.2 16.2 2.9 2.9\"}]\nf:[\"$\",\"path\",\"jadmvz\",{\"d\":\"M12 18v4\"}]\n10:[\"$\",\"path\",\"bwix9q\",{\"d\":\"m4.9 19.1 2.9-2.9\"}]\n11:[\"$\",\"path\",\"j09sii\",{\"d\":\"M2 12h4\"}]\n12:[\"$\",\"path\",\"giyufr\",{\"d\":\"m4.9 4.9 2.9 2.9\"}]\n13:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L15\",null,{\"children\":\"$L16\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L17\",null,{\"children\":[\"$\",\"$9\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L18\"}]}]}],null]}]\n"])</script><script>self.__next_f.push([1,"16:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"19:I[51506,[\"/_next/static/chunks/24ec601050a34de4.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/f0d2ef03bc5b3146.js\",\"/_next/static/chunks/9a18b7330d276141.js\",\"/_next/static/chunks/a3d20a812be16d69.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"\"]\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"pt-28 pb-8 px-6 sm:px-8 md:px-12 lg:px-16 md:pt-20 min-h-screen bg-[radial-gradient(oklch(0.5_0_0/15%)_1px,transparent_1px)] bg-size-[20px_20px]\",\"children\":[\"$\",\"div\",null,{\"className\":\"w-full max-w-4xl mx-auto\",\"children\":[[\"$\",\"$L19\",null,{\"href\":\"/posts\",\"className\":\"inline-flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-6\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"포스트 목록으로 돌아가기\"}]]}],[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"rounded-lg border border-border bg-card text-card-foreground shadow-sm mb-8\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"p-6 pt-6\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"text-3xl sm:text-4xl font-bold text-foreground mb-4\",\"children\":\"Caddy로 멀티테넌트 SSL 자동화하기\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap items-center gap-4 mb-4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center gap-2 text-muted-foreground\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-calendar w-4 h-4\",\"aria-hidden\":\"true\",\"children\":[[\"$\",\"path\",\"1cmpym\",{\"d\":\"M8 2v4\"}],[\"$\",\"path\",\"4m81vk\",{\"d\":\"M16 2v4\"}],[\"$\",\"rect\",\"1hopcy\",{\"width\":\"18\",\"height\":\"18\",\"x\":\"3\",\"y\":\"4\",\"rx\":\"2\"}],[\"$\",\"path\",\"8toen8\",{\"d\":\"M3 10h18\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"children\":\"2026-01-14\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"div\",\"Caddy\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"Caddy\"}],[\"$\",\"div\",\"SSL\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"SSL\"}],[\"$\",\"div\",\"Multi-tenant\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"Multi-tenant\"}],[\"$\",\"div\",\"Infrastructure\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"Infrastructure\"}],[\"$\",\"div\",\"Let's Encrypt\",{\"className\":\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-primary-sky/20 text-primary-sky\",\"children\":\"Let's Encrypt\"}]]}]]}]}],[\"$\",\"article\",null,{\"className\":\"prose prose-neutral dark:prose-invert max-w-none\",\"children\":\"$L1a\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"a:null\n18:[[\"$\",\"title\",\"0\",{\"children\":\"Caddy로 멀티테넌트 SSL 자동화하기 | 안성진\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"Caddy,SSL,Multi-tenant,Infrastructure,Let's Encrypt\"}],[\"$\",\"meta\",\"3\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"Caddy로 멀티테넌트 SSL 자동화하기\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:url\",\"content\":\"https://anveloper.github.io/posts/caddy-multi-tenant-ssl\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:title\",\"content\":\"Caddy로 멀티테넌트 SSL 자동화하기\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:description\",\"content\":\"On-Demand TLS로 커스텀 도메인 인증서를 자동 발급하는 멀티테넌트 리버스 프록시 구축기\"}]]\n"])</script><script>self.__next_f.push([1,"1a:[[\"$\",\"h1\",null,{\"children\":\"Caddy로 멀티테넌트 SSL 자동화하기\",\"className\":\"text-4xl font-bold mt-8 mb-4 text-foreground\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"배경\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"멀티테넌트 스토어 플랫폼에서 3가지 도메인 방식을 지원해야 했다.\",\"className\":\"my-4 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"my-6 overflow-x-auto\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"방식\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}],[\"$\",\"th\",null,{\"children\":\"예시\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}],[\"$\",\"th\",null,{\"children\":\"SSL 인증서\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"경로\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"store.example.com/acme\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"단일 인증서\",\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"서브도메인\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"acme.mystore.app\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"와일드카드 인증서\",\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"커스텀 도메인\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"shop.acme.com\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"개별 인증서 (동적)\",\"className\":\"border border-border px-4 py-2\"}]]}]]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"핵심 문제는 커스텀 도메인이다. 테넌트가 언제든 자신의 도메인을 연결할 수 있어야 하고, SSL 인증서가 자동으로 발급·갱신되어야 한다. Nginx + certbot 조합으로는 새 도메인을 추가할 때마다 설정 파일을 수정하고 reload해야 하는 번거로움이 있었다.\",\"className\":\"my-4 leading-7 text-foreground/90\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"왜 Caddy인가\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"my-6 overflow-x-auto\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"기능\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}],[\"$\",\"th\",null,{\"children\":\"Caddy\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}],[\"$\",\"th\",null,{\"children\":\"Nginx\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"HTTPS\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"기본 제공 (Let's Encrypt)\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"수동 설정 (certbot)\",\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"인증서 갱신\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"자동\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"크론잡 필요\",\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"동적 도메인 추가\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"API로 즉시 반영\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"설정 수정 + reload\",\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"설정 복잡도\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"간단\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"복잡\",\"className\":\"border border-border px-4 py-2\"}]]}]]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Caddy의 \",[\"$\",\"strong\",null,{\"children\":\"On-Demand TLS\",\"className\":\"font-semibold text-foreground\"}],\"가 결정적이었다. 설정 파일 수정 없이, 새로운 도메인으로 요청이 들어오면 검증 API를 호출하고 통과하면 자동으로 인증서를 발급한다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}],\"\\n\",\"$L1b\",\"\\n\",\"$L1c\",\"\\n\",\"$L1d\",\"\\n\",\"$L1e\",\"\\n\",\"$L1f\",\"\\n\",\"$L20\",\"\\n\",\"$L21\",\"\\n\",\"$L22\",\"\\n\",\"$L23\",\"\\n\",\"$L24\",\"\\n\",\"$L25\",\"\\n\",\"$L26\",\"\\n\",\"$L27\",\"\\n\",\"$L28\",\"\\n\",\"$L29\",\"\\n\",\"$L2a\",\"\\n\",\"$L2b\",\"\\n\",\"$L2c\",\"\\n\",\"$L2d\",\"\\n\",\"$L2e\",\"\\n\",\"$L2f\",\"\\n\",\"$L30\",\"\\n\",\"$L31\",\"\\n\",\"$L32\",\"\\n\",\"$L33\",\"\\n\",\"$L34\",\"\\n\",\"$L35\",\"\\n\",\"$L36\",\"\\n\",\"$L37\",\"\\n\",\"$L38\",\"\\n\",\"$L39\",\"\\n\",\"$L3a\",\"\\n\",\"$L3b\",\"\\n\",\"$L3c\",\"\\n\",\"$L3d\",\"\\n\",\"$L3e\"]\n"])</script><script>self.__next_f.push([1,"3f:I[63508,[\"/_next/static/chunks/24ec601050a34de4.js\",\"/_next/static/chunks/44aea766f6f80a25.js\",\"/_next/static/chunks/f0d2ef03bc5b3146.js\",\"/_next/static/chunks/9a18b7330d276141.js\",\"/_next/static/chunks/a3d20a812be16d69.js\",\"/_next/static/chunks/c84805df17f0a72a.js\",\"/_next/static/chunks/948615c9ecde1cb4.js\",\"/_next/static/chunks/85806e5b63a62879.js\",\"/_next/static/chunks/311bfda68bef2673.js\",\"/_next/static/chunks/f87ca1afb6e89cb0.js\",\"/_next/static/chunks/e1a9aaa3e8d4ba89.js\",\"/_next/static/chunks/8fba60bd4135542a.js\"],\"Mermaid\"]\n1b:[\"$\",\"h2\",null,{\"children\":\"아키텍처\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n1c:[\"$\",\"$L3f\",null,{\"chart\":\"flowchart TD\\n  User[사용자] --\u003e|\u0026quot;store.example.com/acme (경로)\\\\nacme.mystore.app (서브도메인)\\\\nshop.acme.com (커스텀 도메인)\u0026quot;| Caddy\\n\\n  Caddy[\u0026quot;Caddy — 443 (HTTPS)\\\\n경로: 단일 인증서\\\\n서브도메인: 와일드카드\\\\n커스텀 도메인: On-Demand TLS\u0026quot;] --\u003e Next[\u0026quot;Next.js 앱 — 4033 (내부)\\\\nHost 헤더 + 경로로 테넌트 식별\u0026quot;]\\n\\n  Next --\u003e DB[Database]\"}]\n1d:[\"$\",\"h2\",null,{\"children\":\"Caddyfile 설정\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n1e:[\"$\",\"h3\",null,{\"children\":\"글로벌 설정: On-Demand TLS\",\"className\":\"text-2xl font-semibold mt-5 mb-2 text-foreground\"}]\n1f:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"{\\n    on_demand_tls {\\n        ask http://localhost:4033/api/caddy/check-domain\\n    }\\n}\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n20:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"ask\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\" 디렉티브가 핵심이다. 새로운 도메인으로 HTTPS 요청이 들어올 때마다, Caddy가 이 URL을 호출하여 인증서를 발급해도 되는지 확인한다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}]\n21:[\"$\",\"h3\",null,{\"children\":\"도메인별 블록\",\"className\":\"text-2xl font-semibold mt-5 mb-2 text-foreground\"}]\n22:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"# 1. 경로 방식 — 단일 인증서\\nstore.example.com {\\n    reverse_proxy localhost:4033\\n}\\n\\n# 2. 서브도메인 방식 — On-Demand TLS\\n*.mystore.app {\\n    tls {\\n        on_demand\\n    }\\n    reverse_proxy localhost:4033\\n}\\n\\n# 3. 커스텀 도메인 방식 — On-Demand TLS\\n:443 {\\n    tls {\\n        on_demand\\n    }\\n    reverse_proxy localhost:4033\\n}\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n23:[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\":443\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\" 블록은 위의 어떤 도메인에도 매칭되지 않는 모든 HTTPS 요청을 잡아낸다. \",[\"$\",\"code\",null,{\"children\":\"on_demand_tls\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"의 \",[\"$\",\"code\",null,{\"children\":\"ask\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\" API가 검증을 통과한 도메인만 인증서가 발급된다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}]\n24:[\"$\",\"h3\",null,{\"children\":\"보안 헤더\",\"className\":\"text-2xl font-semibold mt-5 mb-2 text-foreground\"}]\n25:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"(security_headers) {\\n    @forbidden {\\n        path *.env* *.bak *.php.bak *.sql *.log *.ini\\n        path /storage/* /artisan /config/* /var/log/*\\n        path /.git* /.htaccess /.htpasswd\\n    }\\n    respond @forbidden \\\"Access Denied\\\" 403\\n}\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n26:[\"$\",\"h2\",null,{\"children\":\"도메인 검증 API\",\"className\":\"text-3xl font"])</script><script>self.__next_f.push([1,"-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n27:[\"$\",\"p\",null,{\"children\":\"Caddy가 인증서 발급 전에 호출하는 검증 엔드포인트다.\",\"className\":\"my-4 leading-7 text-foreground/90\"}]\n28:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"GET /api/caddy/check-domain?domain=shop.acme.com\\n\\n200 OK     → 인증서 발급 허용 (DB에 해당 도메인의 테넌트 존재)\\n404 Not Found → 인증서 발급 거부\\n\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n29:[\"$\",\"p\",null,{\"children\":[\"DB에서 \",[\"$\",\"code\",null,{\"children\":\"Tenant.domain\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"이나 \",[\"$\",\"code\",null,{\"children\":\"Tenant.tenantName\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"으로 해당 도메인을 사용하는 테넌트가 있는지 확인한다. 없으면 404를 반환하여 인증서 발급을 차단한다. 이렇게 하면 악의적인 도메인으로 인증서가 남발되는 것을 방지할 수 있다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}]\n2a:[\"$\",\"h2\",null,{\"children\":\"Next.js proxy.ts에서 도메인 라우팅\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n2b:[\"$\",\"p\",null,{\"children\":[\"Next.js 16에서는 기존 \",[\"$\",\"code\",null,{\"children\":\"middleware.ts\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"가 \",[\"$\",\"code\",null,{\"children\":\"proxy.ts\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"로 변경되었다. 여기서 서브도메인과 커스텀 도메인 요청을 경로 기반으로 rewrite한다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}]\n2c:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"// proxy.ts (Next.js 16)\\nexport function proxy(request: Request) {\\n  const host = request.headers.get(\\\"host\\\");\\n  const url = new URL(request.url);\\n\\n  // 서브도메인 방식: acme.mystore.app → /acme/...\\n  for (const subdomainHost of SUBDOMAIN_HOSTS) {\\n    if (host?.endsWith(`.${subdomainHost}`)) {\\n      const tenantName = host.replace(`.${subdomainHost}`, \\\"\\\");\\n      url.pathname = `/${tenantName}${url.pathname}`;\\n      return NextResponse.rewrite(url);\\n    }\\n  }\\n\\n  // 커스텀 도메인 방식: shop.acme.com → DB 조회 → /tenantName/...\\n  // ...\\n}\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n2d:[\"$\",\"p\",null,{\"children\":[\"이렇게 하면 애플리케이션 내부에서는 항상 \",[\"$\",\"code\",null,{\"children\":\"app/[tenant]/...\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\" 라우트로 통일되어 처리된다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}]\n2e:[\"$\",\"h2\",null,{\"children\":\"와일드카드 인증서: Cloudflare DNS 연동\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n2f:[\"$\",\"p\",null,{\"children\":[\"서브도메인 방식(\",[\"$\",\"code\",null,{\"children\":\"*.mystore.app\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\")에 와일드카드 인증서가 필요하면, DNS 챌린지를 위해 Cloudflare DNS 플러그인을 포함한 Caddy를 빌드해야 한다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}]\n30:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"# xcaddy로 Cloudflare 플러그인 포함 빌드\\ngo install github.com/caddyserver/xcaddy/cmd/xcaddy@latest\\nxcaddy build --with github.com/caddy-dns/cloudflare\\n\\nsudo mv caddy /usr/bin/caddy\\nsudo systemctl restart caddy\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n31:[\"$\",\"p\",null,{\"children\":\"Caddyfile에서 Cloudflare DNS 프로바이더를 설정한다.\""])</script><script>self.__next_f.push([1,",\"className\":\"my-4 leading-7 text-foreground/90\"}]\n32:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"*.mystore.app {\\n    tls {\\n        dns cloudflare {env.CF_API_TOKEN}\\n    }\\n    reverse_proxy localhost:4033\\n}\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n33:[\"$\",\"p\",null,{\"children\":\"Cloudflare API 토큰은 systemd 서비스에 환경변수로 주입한다.\",\"className\":\"my-4 leading-7 text-foreground/90\"}]\n34:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"sudo systemctl edit caddy\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n35:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"[Service]\\nEnvironment=\\\"CF_API_TOKEN=your-cloudflare-api-token\\\"\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n36:[\"$\",\"h2\",null,{\"children\":\"배포: PM2 + systemd\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n37:[\"$\",\"p\",null,{\"children\":\"단일 서버 환경에서는 Docker 없이 Caddy(systemd) + Node.js(PM2) 조합이 간단하다.\",\"className\":\"my-4 leading-7 text-foreground/90\"}]\n38:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\",\"children\":\"# Caddy 설치 (Ubuntu/Debian)\\nsudo apt install caddy\\n\\n# Node.js 앱 시작\\npm2 start pnpm --name \\\"dps-store\\\" -- start\\npm2 startup \u0026\u0026 pm2 save\\n\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n39:[\"$\",\"pre\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"/etc/caddy/Caddyfile                  ← Caddy 설정\\n/var/lib/caddy/.local/share/caddy/    ← SSL 인증서 (자동 관리)\\n/home/ubuntu/dps-store/               ← Next.js 앱\\n\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\"className\":\"bg-muted p-4 rounded-lg overflow-x-auto my-4 font-mono text-sm\"}]\n3a:[\"$\",\"h2\",null,{\"children\":\"주의사항\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n"])</script><script>self.__next_f.push([1,"3b:[\"$\",\"div\",null,{\"className\":\"my-6 overflow-x-auto\",\"children\":[\"$\",\"table\",null,{\"className\":\"w-full border-collapse\",\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"항목\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}],[\"$\",\"th\",null,{\"children\":\"내용\",\"className\":\"border border-border px-4 py-2 text-left font-semibold\"}]]}],\"className\":\"bg-muted\"}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Rate Limit\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"Let's Encrypt는 주당 50개 인증서 발급 제한. 커스텀 도메인에만 해당\",\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"도메인 검증\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"check-domain\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\" API 필수. 없으면 아무 도메인이나 인증서 발급 시도\"],\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"인증서 저장\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"Caddy 데이터 디렉토리 영구 보존 필수 (삭제 시 재발급 필요)\",\"className\":\"border border-border px-4 py-2\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"DNS 전파\",\"className\":\"border border-border px-4 py-2\"}],[\"$\",\"td\",null,{\"children\":\"새 도메인 네임서버 변경 시 최대 48시간 소요\",\"className\":\"border border-border px-4 py-2\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"3c:[\"$\",\"h2\",null,{\"children\":\"마무리\",\"className\":\"text-3xl font-semibold mt-6 mb-3 text-foreground border-b border-border pb-2\"}]\n3d:[\"$\",\"p\",null,{\"children\":[\"Caddy의 On-Demand TLS 덕분에 코드 한 줄 수정 없이 커스텀 도메인을 동적으로 추가할 수 있게 되었다. 핵심은 검증 API(\",[\"$\",\"code\",null,{\"children\":\"/api/caddy/check-domain\",\"className\":\"bg-muted px-1.5 py-0.5 rounded text-sm font-mono text-foreground\"}],\")를 통해 인증서 발급 대상을 통제하는 것이다.\"],\"className\":\"my-4 leading-7 text-foreground/90\"}]\n3e:[\"$\",\"p\",null,{\"children\":\"경로/서브도메인/커스텀 도메인 3가지 방식을 하나의 Caddyfile로 처리하는 구성은, Nginx였다면 상당히 복잡했을 것이다. 멀티테넌트 SaaS를 구축한다면 Caddy + On-Demand TLS 조합을 추천한다.\",\"className\":\"my-4 leading-7 text-foreground/90\"}]\n"])</script></body></html>